# 生成器難度參數設計心得與建議

> **專案**: 數學測驗生成器架構設計
> **制定日期**: 2025-09-19
> **狀態**: 📋 **研擬完成** - 基於TrigonometricFunctionGenerator分析
> **範圍**: 生成器參數設計的統一原則和最佳實踐

## 🔍 **問題發現與分析**

### **觸發問題**
在檢查TrigonometricFunctionGenerator時，發現了看似的「回傳值衝突」：
- 初始化接收：`"normal"` 或 `"hard"`（小寫）
- 返回方法：固定返回 `"MEDIUM"`（大寫）
- 用戶配置：看似被完全忽略

### **深度調查結果**

#### **現有生成器的「難度」處理現狀**
| 生成器 | difficulty參數 | 實際功能影響 | get_difficulty()方法 | PDF顯示 |
|--------|----------------|-------------|-------------------|---------|
| **DoubleRadical** | 無 | 無任何影響 | 無，直接返回"MEDIUM" | "MEDIUM" |
| **InverseTrig** | 有，預設"MEDIUM" | 無實際邏輯 | 無 | "MEDIUM" |
| **TrigonometricFunction** | 有"normal"/"hard" | ✅ 控制函數數量(3vs6) | 有，返回固定"MEDIUM" | "MEDIUM" |

#### **關鍵發現**
1. **PDF系統需求**: 需要固定的分類標籤，不是動態難度
2. **生成器配置**: `difficulty`實際上是「配置選項」，不是「難度等級」
3. **概念混淆**: 將「內部配置」與「外部分類」混為一談

## 🎯 **設計原則澄清**

### **「難度」vs「配置選項」的本質區別**

#### **PDF難度標籤（外部分類）**
```python
def get_difficulty(self) -> str:
    """返回PDF顯示用的固定難度分類

    用於題目分類和顯示，應該基於題型本身的複雜度，
    而非用戶配置選項。
    """
    return "MEDIUM"  # 三角函數計算統一為中等難度
```

**特徵**：
- 固定值，基於題型本身複雜度
- 用於PDF生成系統的分類顯示
- 不應該因用戶配置而改變
- 統一標準：EASY/MEDIUM/HARD

#### **生成器配置選項（內部行為）**
```python
def __init__(self, options: Dict[str, Any] = None):
    """初始化生成器配置

    配置選項控制生成器內部行為，不影響外部分類。
    """
    options = options or {}
    # 這是配置選項，控制函數選擇範圍
    function_scope = options.get("function_scope", "basic")  # basic/extended
    self.functions = [sin, cos, tan, cot, sec, csc] if function_scope == "extended" else [sin, cos, tan]
```

**特徵**：
- 動態配置，影響內部生成邏輯
- 不影響PDF分類系統
- 參數名稱應該具體明確
- 用於控制生成器行為變化

### **TrigonometricFunctionGenerator的正確性驗證**

#### **當前實現評估**
```python
# ✅ PDF難度分類 - 正確
def get_difficulty(self) -> str:
    return "MEDIUM"  # 三角函數計算確實是中等難度

# ❌ 參數命名 - 概念混淆
difficulty = options.get("difficulty", "normal")  # 應該改名
self.functions = [...] if difficulty == "hard" else [...]
```

#### **建議修正**
```python
# ✅ 概念清晰的參數命名
function_scope = options.get("function_scope", "basic")  # basic/extended
self.functions = [...] if function_scope == "extended" else [...]

# 或更具體的命名
function_set = options.get("function_set", "primary")  # primary/complete
complexity_level = options.get("complexity", "standard")  # standard/advanced
```

## 💡 **設計建議與最佳實踐**

### **統一設計原則**

#### **1. 概念分離原則**
- **外部分類**：固定的PDF難度標籤，基於題型複雜度
- **內部配置**：動態的行為控制選項，影響生成邏輯

#### **2. 命名清晰原則**
```python
# ❌ 概念混淆的命名
difficulty = options.get("difficulty", "normal")

# ✅ 概念清晰的命名
function_scope = options.get("function_scope", "basic")
content_range = options.get("content_range", "standard")
complexity_level = options.get("complexity", "standard")
```

#### **3. 功能單一原則**
- 每個參數只控制一個明確的行為面向
- 避免一個參數影響多個不相關的功能
- 保持配置選項的獨立性

### **具體實施建議**

#### **對於TrigonometricFunctionGenerator**
```python
class TrigonometricFunctionGenerator(QuestionGenerator):
    def __init__(self, options: Dict[str, Any] = None):
        options = options or {}

        # ✅ 清晰的配置選項命名
        function_scope = options.get("function_scope", "basic")  # basic/extended
        self.angle_mode = options.get("angle_mode", "degree")    # degree/radian/mixed

        # 基於配置選擇函數集合
        if function_scope == "extended":
            self.functions = [sin, cos, tan, cot, sec, csc]  # 6個函數
        else:
            self.functions = [sin, cos, tan]                 # 3個函數

    def get_difficulty(self) -> str:
        """返回固定的PDF分類標籤"""
        return "MEDIUM"  # 三角函數計算統一為中等難度
```

#### **對於其他生成器**
```python
# DoubleRadical - 無需配置選項
def get_difficulty(self) -> str:
    return "MEDIUM"  # 雙重根式化簡為中等難度

# InverseTrig - 清理無用的difficulty參數
def __init__(self, options: Dict[str, Any] = None):
    # 移除無用的difficulty參數，專注有效配置
    options = options or {}
    self.max_value = options.get('max_value', 10)
```

## 🎯 **標準化建議**

### **生成器設計規範**

#### **必須實現**
```python
def get_difficulty(self) -> str:
    """返回PDF分類用的固定難度標籤

    基於題型本身複雜度，不受用戶配置影響。
    """
    return "EASY" | "MEDIUM" | "HARD"  # 三選一
```

#### **配置參數命名指南**
- `function_scope`: 函數範圍選擇（basic/extended）
- `content_range`: 內容範圍控制（standard/comprehensive）
- `complexity_level`: 複雜度等級（simple/standard/advanced）
- `angle_mode`: 角度模式（degree/radian/mixed）
- `format_style`: 格式風格（standard/detailed）

#### **避免的命名**
- ❌ `difficulty`: 與PDF分類概念混淆
- ❌ `level`: 語義不夠具體
- ❌ `mode`: 過於籠統
- ❌ `type`: 意義模糊

### **PDF分類標準**

#### **難度分級建議**
- **EASY**: 基礎運算，單一概念（如基本三角函數值）
- **MEDIUM**: 中等複雜度，需要推理（如三角函數計算、根式化簡）
- **HARD**: 高複雜度，多步驟推理（如複合函數、複雜幾何）

#### **當前生成器分類**
- `TrigonometricFunctionGenerator`: MEDIUM（需要單位圓概念）
- `DoubleRadicalSimplificationGenerator`: MEDIUM（需要根式化簡技巧）
- `InverseTrigonometricFunctionGenerator`: MEDIUM（需要反函數概念）

## ✅ **總結與行動建議**

### **核心發現**
1. **TrigonometricFunctionGenerator的實現是正確的**：返回固定"MEDIUM"符合PDF分類需求
2. **問題在於概念混淆**：將配置選項誤稱為"difficulty"
3. **系統設計是合理的**：PDF需要固定分類，生成器需要靈活配置

### **建議行動**
1. **保持現有get_difficulty()邏輯**：返回固定值是正確設計
2. **重新命名配置參數**：將"difficulty"改為具體的功能描述
3. **建立命名規範**：統一所有生成器的參數命名風格
4. **文檔化設計原則**：明確區分外部分類vs內部配置

### **優先級評估**
- **高優先級**：澄清設計概念，避免未來混淆
- **中優先級**：重新命名參數，提升代碼可讀性
- **低優先級**：統一其他生成器的參數風格

---

**文檔狀態**: ✅ **分析完成** - 澄清了難度參數的設計原則
**關鍵洞察**: 「難度」是PDF分類標籤，「配置選項」是生成器行為控制
**設計驗證**: TrigonometricFunctionGenerator的實現邏輯正確，問題在於命名混淆