# 三角函數生成器重寫計畫

> **專案**: TrigonometricFunctionGenerator系統性重寫 + 弧度版整合
> **制定日期**: 2025-09-18
> **基於經驗**: InverseTrigonometricFunctionGenerator典範重寫 + 全面重寫實施計畫
> **目標**: 移除Pydantic過度工程化，整合弧度版功能，建立統一的三角函數生成器典範

## 📊 **現狀分析**

### **當前UI系統中的重複問題** (關鍵發現)
從系統註冊日誌確認當前有**兩個分離的三角函數生成器**：

```
✅ TrigonometricFunctionGenerator [三角函數/三角函數值練習_角度] (ID: 2)
✅ TrigonometricFunctionGeneratorRadius [三角函數/三角函數值_弧度角] (ID: 5)
```

**UI中的實際問題**：
- **用戶困惑**: UI分類選單中有兩個功能幾乎相同的選項
- **維護困難**: 度數版558行 + 弧度版代碼 = 重複維護負擔
- **配置缺失**: 無法在同一生成器中切換難度和角度單位
- **系統複雜**: 兩套獨立註冊，增加系統複雜度

### **統一整合的UI價值** (核心必要性)

**整合前UI體驗**：
```
三角函數/
├── 三角函數值練習_角度      (度數版，功能重複)
├── 三角函數值_弧度角        (弧度版，功能重複)
├── 反三角函數值計算
└── 三角函數角度轉換
```

**整合後UI體驗**：
```
三角函數/
├── 三角函數值計算          (統一版，支援配置)
├── 反三角函數值計算
└── 三角函數角度轉換

配置選項：
├── 難度: [Normal▼] [Hard]     (3函數 vs 6函數)
└── 角度單位: [度數▼] [弧度]   (統一切換)
```

### **膨脹程度評估與整合機會**
- **度數版當前**: TrigonometricFunctionGenerator (558行，過度工程化)
- **弧度版當前**: TrigonometricFunctionGeneratorRadius (估計200-300行)
- **合計問題**: 約800行重複功能代碼
- **整合目標**: 統一為300行以內的單一生成器
- **減少比例**: ~60%代碼減少 + 消除UI重複選項
- **嚴重程度**: 🔴 高優先級統一整合 (解決UI使用體驗問題)

### **過度工程化識別**
```python
# ❌ 確認發現的問題
class TrigonometricParams(BaseModel):     # Pydantic過度工程
class TrigFunction(str, Enum):            # 不必要的枚舉抽象
# 預估50-80行的參數驗證代碼用於處理簡單配置
```

## 🎯 **重寫策略**

### **核心指導原則** (基於典範經驗 + UI整合需求)
1. **教學正確性優先**: 不為行數優化破壞數學邏輯
2. **保留菁華部分**: 圖形整合、特殊角計算、異常處理
3. **移除糟粕部分**: Pydantic類、複雜枚舉、過度分割
4. **應用LaTeX標準**: 使用已建立的轉義規範
5. **統一整合**: 度數版+弧度版整合為單一生成器，解決UI重複問題
6. **UI配置協調**: 與UI配置系統協調，支援difficulty和angle_unit參數

### **與UI系統整合的必要性** (核心價值確認)

**解決實際的UI使用問題**：
- **消除重複選項**: 從2個相似選項合併為1個統一選項
- **提升用戶體驗**: 清楚的配置選擇，而非混亂的重複功能
- **為UI配置系統提供實際應用場景**: 驗證配置系統的實用性
- **建立生成器配置範例**: 為未來其他生成器提供difficulty參數設計參考

**統一生成器的配置接口設計**：
```python
# 統一後的生成器實例化
generator = TrigonometricFunctionGenerator({
    "difficulty": "normal",      # normal(3函數) vs hard(6函數)
    "angle_unit": "degree"       # degree vs radian
})

# UI配置傳遞路徑
UI設定 → selected_data["config"] → 生成器options參數 → 統一邏輯處理
```

**與UI配置計畫的協調**：
- 這個統一整合為UI配置系統提供了**真實的使用需求**
- 避免了UI配置系統成為"為了配置而配置"的過度工程
- 證明了difficulty和angle_unit配置的實用價值

### **取其菁華** (基於舊版分析修正 + 整合優勢)
```python
✅ 舊版動態查詢表邏輯 (sympy自動簡化，完美設計)
✅ 圖形數據整合 (新版重要價值)
✅ 異常處理框架 (新版保護機制)
✅ 純模版詳解系統 (比40+行if-else更簡潔)
✅ LaTeX標準化格式 (基於InverseTrig經驗)
✅ 弧度版角度處理邏輯 (latex(angle)自動格式化)
✅ 度數/弧度統一框架設計
```

### **去其糟粕** (預估移除250-300行 + 消除重複)
```python
❌ TrigonometricParams(BaseModel)類      # ~60行
❌ TrigFunction(str, Enum)類              # ~15行
❌ 複雜的參數驗證邏輯                     # ~40行
❌ 舊版40+行詳解if-else邏輯              # ~50行 (改用純模版)
❌ 不必要的配置抽象                       # ~50行
❌ 弧度版重複邏輯                         # ~200行 (整合消除)
```

## 🏗️ **詳細實施計畫** (完整統一整合版)

### **Phase 1: 完整統一架構重建** (50分鐘)

#### **1.1 統一參數處理** (20分鐘) - 整合難度+角度單位
```python
# ❌ 移除過度工程化
class TrigonometricParams(BaseModel): ...

# ✅ 採用典範模式 + 整合設計
def __init__(self, options: Dict[str, Any] = None):
    super().__init__(options)
    self.logger = get_logger(self.__class__.__name__)

    options = options or {}

    # 難度控制 (用戶新需求)
    difficulty = options.get("difficulty", "normal")
    if difficulty == "hard":
        self.functions = [sin, cos, tan, cot, sec, csc]  # 6種函數
    else:  # normal
        self.functions = [sin, cos, tan]  # 3種基礎函數

    # 角度單位選擇 (整合弧度版)
    self.angle_unit = options.get("angle_unit", "degree")  # "degree" 或 "radian"

    if self.angle_unit == "radian":
        self.angles = [0, pi/6, pi/4, pi/3, pi/2, 2*pi/3, 3*pi/4, 5*pi/6, pi,
                      7*pi/6, 5*pi/4, 4*pi/3, 3*pi/2, 5*pi/3, 7*pi/4, 11*pi/6, 2*pi]
    else:  # degree
        self.angles = [0, 30, 45, 60, 90, 120, 135, 150, 180,
                      210, 225, 240, 270, 300, 315, 330, 360]
```

#### **1.2 枚舉類移除** (10分鐘)
```python
# ❌ 移除不必要抽象
class TrigFunction(str, Enum): ...

# ✅ 直接使用字串，配合字典映射
self.func_map = {
    "sin": "\\sin", "cos": "\\cos", "tan": "\\tan",
    "cot": "\\cot", "sec": "\\sec", "csc": "\\csc"
}
```

#### **1.3 統一生成邏輯重構** (15分鐘) - 支援度數/弧度
```python
def generate_question(self) -> Dict[str, Any]:
    """基於典範經驗 + 統一度數/弧度處理"""
    self.logger.info(f"開始生成三角函數題目 ({self.angle_unit})")

    for attempt in range(100):
        try:
            # 舊版的直接邏輯：隨機選擇 + 查詢表
            angle = random.choice(self.angles)
            func = random.choice(self.functions)
            value = self.trig_values.get((func, angle))

            # 避開ERROR值 (舊版邏輯)
            while value == "ERROR":
                angle = random.choice(self.angles)
                func = random.choice(self.functions)
                value = self.trig_values.get((func, angle))

            # 格式化題目和答案 (支援兩種單位)
            question = self._format_question(func.__name__, angle)
            answer = f"${latex(value)}$"

            # 統一詳解模版 (自動適應單位)
            explanation = self._generate_explanation(func.__name__, angle, value)

            return self._build_complete_response(question, answer, explanation, angle)

        except Exception as e:
            self.logger.warning(f"生成嘗試失敗: {str(e)}")
            continue

    return self._get_fallback_question()
```

### **Phase 2: 統一數據結構重建** (40分鐘)

#### **2.1 統一查詢表建構** (25分鐘) - 度數/弧度雙支援
```python
def _build_unified_trig_table(self):
    """統一處理度數和弧度的查詢表，無過渡考慮"""
    table = {}

    # 直接建構完整統一表格
    for func in self.functions:  # 3種或6種函數
        for angle in self.angles:  # 度數列表或弧度列表
            key = (func, angle)
            try:
                if self.angle_unit == "radian":
                    # 弧度版：直接使用sympy角度
                    value = simplify(func(angle))
                else:
                    # 度數版：轉換為弧度計算
                    angle_rad = angle * pi / 180
                    value = simplify(func(angle_rad))
                table[key] = value
            except Exception:
                table[key] = "ERROR"
    return table
```

#### **2.2 完整圖形系統整合** (15分鐘) - 度數/弧度統一
```python
def _build_figure_data(self, angle, func_name: str):
    """統一的圖形數據生成，自動處理單位轉換"""
    # 圖形系統始終使用度數，需要統一轉換
    if self.angle_unit == "radian":
        display_angle = float(angle * 180 / pi)  # 轉為度數顯示
        angle_display = f"{latex(angle)} \\text{{ rad}} = {display_angle:.0f}^\\circ"
    else:
        display_angle = angle
        angle_display = f"{angle}^\\circ"

    return {
        'type': 'standard_unit_circle',
        'params': {
            'variant': 'question',
            'angle': display_angle,  # 圖形系統統一使用度數
            'highlight_function': func_name,
            'show_coordinates': True
        },
        'options': {'scale': 1.0}
    }
```

### **Phase 3: 完整模版系統重建** (50分鐘)

#### **3.1 統一LaTeX格式化** (15分鐘) - 度數/弧度雙支援
```python
def _format_question_answer(self, func_name: str, angle, value):
    """統一的題目答案格式化，支援雙單位"""
    if self.angle_unit == "radian":
        question = f"$\\{func_name}({latex(angle)}) = $"
        answer = f"${latex(value)}$"
    else:  # degree
        question = f"$\\{func_name}({angle}^\\circ) = $"
        answer = f"${latex(value)}$"

    return question, answer
```

#### **3.2 完整模版系統** (35分鐘) - 6函數×2單位×特殊情況
```python
# 完整模版系統：覆蓋所有函數和單位組合
EXPLANATION_TEMPLATES = {
    # === 度數版基礎函數模版 ===
    "sin_degree": "因為 $\\sin \\theta = \\frac{{y}}{{r}}$，即單位圓上點的y座標值\\\\[0.3em]當 $\\theta = {angle}^\\circ$ 時，點的座標為 $({x_latex}, {y_latex})$\\\\[0.3em]所以 $\\sin({angle}^\\circ) = {y_latex}$",

    "cos_degree": "因為 $\\cos \\theta = \\frac{{x}}{{r}}$，即單位圓上點的x座標值\\\\[0.3em]當 $\\theta = {angle}^\\circ$ 時，點的座標為 $({x_latex}, {y_latex})$\\\\[0.3em]所以 $\\cos({angle}^\\circ) = {x_latex}$",

    "tan_degree": "因為 $\\tan \\theta = \\frac{{y}}{{x}} = \\frac{{\\sin \\theta}}{{\\cos \\theta}}$\\\\[0.3em]當 $\\theta = {angle}^\\circ$ 時，$\\sin({angle}^\\circ) = {y_latex}$，$\\cos({angle}^\\circ) = {x_latex}$\\\\[0.3em]所以 $\\tan({angle}^\\circ) = \\frac{{{y_latex}}}{{{x_latex}}} = {result_latex}$",

    # === 弧度版基礎函數模版 ===
    "sin_radian": "因為 $\\sin \\theta = \\frac{{y}}{{r}}$，即單位圓上點的y座標值\\\\[0.3em]當 $\\theta = {angle_latex}$ 時，點的座標為 $({x_latex}, {y_latex})$\\\\[0.3em]所以 $\\sin({angle_latex}) = {y_latex}$",

    "cos_radian": "因為 $\\cos \\theta = \\frac{{x}}{{r}}$，即單位圓上點的x座標值\\\\[0.3em]當 $\\theta = {angle_latex}$ 時，點的座標為 $({x_latex}, {y_latex})$\\\\[0.3em]所以 $\\cos({angle_latex}) = {x_latex}$",

    "tan_radian": "因為 $\\tan \\theta = \\frac{{y}}{{x}} = \\frac{{\\sin \\theta}}{{\\cos \\theta}}$\\\\[0.3em]當 $\\theta = {angle_latex}$ 時，$\\sin({angle_latex}) = {y_latex}$，$\\cos({angle_latex}) = {x_latex}$\\\\[0.3em]所以 $\\tan({angle_latex}) = \\frac{{{y_latex}}}{{{x_latex}}} = {result_latex}$",

    # === 度數版擴展函數模版 (hard難度) ===
    "cot_degree": "因為 $\\cot \\theta = \\frac{{x}}{{y}} = \\frac{{\\cos \\theta}}{{\\sin \\theta}}$\\\\[0.3em]當 $\\theta = {angle}^\\circ$ 時，點的座標為 $({x_latex}, {y_latex})$\\\\[0.3em]所以 $\\cot({angle}^\\circ) = \\frac{{{x_latex}}}{{{y_latex}}} = {result_latex}$",

    "sec_degree": "因為 $\\sec \\theta = \\frac{{r}}{{x}} = \\frac{{1}}{{\\cos \\theta}}$\\\\[0.3em]當 $\\theta = {angle}^\\circ$ 時，$\\cos({angle}^\\circ) = {x_latex}$\\\\[0.3em]所以 $\\sec({angle}^\\circ) = \\frac{{1}}{{{x_latex}}} = {result_latex}$",

    "csc_degree": "因為 $\\csc \\theta = \\frac{{r}}{{y}} = \\frac{{1}}{{\\sin \\theta}}$\\\\[0.3em]當 $\\theta = {angle}^\\circ$ 時，$\\sin({angle}^\\circ) = {y_latex}$\\\\[0.3em]所以 $\\csc({angle}^\\circ) = \\frac{{1}}{{{y_latex}}} = {result_latex}$",

    # === 弧度版擴展函數模版 (hard難度) ===
    "cot_radian": "因為 $\\cot \\theta = \\frac{{x}}{{y}} = \\frac{{\\cos \\theta}}{{\\sin \\theta}}$\\\\[0.3em]當 $\\theta = {angle_latex}$ 時，點的座標為 $({x_latex}, {y_latex})$\\\\[0.3em]所以 $\\cot({angle_latex}) = \\frac{{{x_latex}}}{{{y_latex}}} = {result_latex}$",

    "sec_radian": "因為 $\\sec \\theta = \\frac{{r}}{{x}} = \\frac{{1}}{{\\cos \\theta}}$\\\\[0.3em]當 $\\theta = {angle_latex}$ 時，$\\cos({angle_latex}) = {x_latex}$\\\\[0.3em]所以 $\\sec({angle_latex}) = \\frac{{1}}{{{x_latex}}} = {result_latex}$",

    "csc_radian": "因為 $\\csc \\theta = \\frac{{r}}{{y}} = \\frac{{1}}{{\\sin \\theta}}$\\\\[0.3em]當 $\\theta = {angle_latex}$ 時，$\\sin({angle_latex}) = {y_latex}$\\\\[0.3em]所以 $\\csc({angle_latex}) = \\frac{{1}}{{{y_latex}}} = {result_latex}$",

    # === 特殊情況：未定義值模版 ===
    "undefined_degree": "當 $\\theta = {angle}^\\circ$ 時，${func_latex}({angle}^\\circ)$ 未定義\\\\[0.3em]因為此時分母為零",
    "undefined_radian": "當 $\\theta = {angle_latex}$ 時，${func_latex}({angle_latex})$ 未定義\\\\[0.3em]因為此時分母為零"
}

def _generate_explanation(self, func_name: str, angle, value):
    """完整的統一模版系統"""
    # 直接確定模版鍵值
    if self._is_undefined_value(value):
        template_key = f"undefined_{self.angle_unit}"
        return EXPLANATION_TEMPLATES[template_key].format(
            angle=(angle if self.angle_unit == "degree" else None),
            angle_latex=(latex(angle) if self.angle_unit == "radian" else None),
            func_latex=f"\\{func_name}"
        )

    # 正常值使用函數特定模版
    template_key = f"{func_name}_{self.angle_unit}"

    # 計算座標值 (統一處理)
    x_coord, y_coord = self._get_unit_circle_coordinates(angle)

    if self.angle_unit == "radian":
        return EXPLANATION_TEMPLATES[template_key].format(
            angle_latex=latex(angle),
            x_latex=latex(x_coord),
            y_latex=latex(y_coord),
            result_latex=latex(value)
        )
    else:  # degree
        return EXPLANATION_TEMPLATES[template_key].format(
            angle=angle,
            x_latex=latex(x_coord),
            y_latex=latex(y_coord),
            result_latex=latex(value)
        )
```

#### **3.3 典範註解標準應用** (基於代碼註解標準與規範)
```python
def __init__(self, options: Dict[str, Any] = None):
    """統一三角函數生成器 - 度數/弧度雙模式支援

    整合度數版(242行)和弧度版(251行)為統一實現，支援難度分級。
    """
    super().__init__(options)
    self.logger = get_logger(self.__class__.__name__)

    options = options or {}

    # 難度控制 - 決定可用函數範圍，確保教學適配性
    difficulty = options.get("difficulty", "normal")
    if difficulty == "hard":
        # 6種函數：適用於進階學習者
        self.functions = [sin, cos, tan, cot, sec, csc]
    else:  # normal
        # 3種基礎函數：適用於初學者
        self.functions = [sin, cos, tan]

    # 角度單位選擇 - 統一處理度數和弧度模式
    self.angle_unit = options.get("angle_unit", "degree")

    if self.angle_unit == "radian":
        # 弧度模式：使用sympy符號確保精確計算
        self.angles = [0, pi/6, pi/4, pi/3, pi/2, 2*pi/3, 3*pi/4, 5*pi/6, pi,
                      7*pi/6, 5*pi/4, 4*pi/3, 3*pi/2, 5*pi/3, 7*pi/4, 11*pi/6, 2*pi]
    else:  # degree
        # 度數模式：使用整數角度便於教學
        self.angles = [0, 30, 45, 60, 90, 120, 135, 150, 180,
                      210, 225, 240, 270, 300, 315, 330, 360]

def _build_unified_trig_table(self):
    """統一查詢表建構 - 度數/弧度雙支援

    避免重複計算，確保數學值的一致性和正確性。
    """
    table = {}

    for func in self.functions:
        for angle in self.angles:
            key = (func, angle)
            try:
                if self.angle_unit == "radian":
                    # 弧度：直接使用sympy角度，保持符號精確性
                    value = simplify(func(angle))
                else:
                    # 度數：轉換為弧度計算，確保與弧度模式結果一致
                    angle_rad = angle * pi / 180
                    value = simplify(func(angle_rad))
                table[key] = value
            except Exception:
                # 記錄未定義值（如tan(90°)），供後續處理
                table[key] = "ERROR"
    return table

def _format_question_answer(self, func_name: str, angle, value):
    """統一題目答案格式化 - 防範Unicode符號錯誤

    使用正確LaTeX語法，避免PDF顯示問題。
    """
    if self.angle_unit == "radian":
        # 弧度模式：使用latex()自動格式化複雜分數
        question = f"$\\{func_name}({latex(angle)}) = $"
    else:  # degree
        # 度數模式：使用^\\circ確保度數符號正確顯示
        question = f"$\\{func_name}({angle}^\\circ) = $"

    # 統一答案格式：使用latex()確保數學表達式標準化
    answer = f"${latex(value)}$"
    return question, answer

def _generate_explanation(self, func_name: str, angle, value):
    """完整統一模版系統 - 18個模版覆蓋所有情況

    避免40+行if-else邏輯，使用純模版提升可維護性。
    """
    # 檢查未定義值 - 特殊情況優先處理
    if self._is_undefined_value(value):
        template_key = f"undefined_{self.angle_unit}"
        # ... 模版格式化邏輯

    # 正常值處理 - 函數×單位自動匹配對應模版
    template_key = f"{func_name}_{self.angle_unit}"

    # 單位圓座標計算 - 確保解釋邏輯的數學正確性
    x_coord, y_coord = self._get_unit_circle_coordinates(angle)

    # ... 統一參數注入邏輯
```

**註解標準重點** (基於代碼註解標準與規範_已完成.md):

✅ **有效註解類型**:
1. **數學邏輯註解**: 防止代碼說bug話，確保三角函數定義域/值域正確
2. **工具選擇說明**: 說明為何使用sympy、latex()、f字串等技術決策
3. **邊界條件檢查**: 特殊角度、未定義值、單位轉換的處理邏輯
4. **LaTeX格式防範**: 確保^\\circ而非°、\\\\[0.3em]而非HTML標籤

❌ **禁止註解類型**:
- 歷史對比 ("從舊版改進"、"移除Pydantic")
- 口號式 ("最佳實踐"、"已證實可靠")
- 代碼重複說明 ("設定變數a"、"返回字典")
- 無法驗證斷言 ("完全正確的邏輯")

### **Phase 4: 完整實現與驗證** (35分鐘)

#### **4.1 完整統一實現** (25分鐘) - 無過渡期考慮
```python
# 直接實現完整統一架構
- [ ] 統一參數配置：{difficulty: "normal"/"hard", angle_unit: "degree"/"radian"}
- [ ] 完整函數支援：sin/cos/tan (normal) + cot/sec/csc (hard)
- [ ] 雙單位角度處理：度數列表 + 弧度列表
- [ ] 統一查詢表：支援6函數×17角度×2單位 = 204種組合
- [ ] 完整模版系統：18個模版覆蓋所有情況
- [ ] 圖形系統整合：自動單位轉換，統一顯示邏輯

# 統一架構驗證
- [ ] 度數模式：完整計算與顯示正確
- [ ] 弧度模式：latex(angle)格式化完美
- [ ] 難度切換：3函數/6函數自動調整
- [ ] 圖形整合：所有單位組合正確顯示
- [ ] 模版適應：自動選擇對應格式
```

#### **4.2 典範價值確立** (10分鐘) - 統一設計標準
- [ ] 完整統一：從493行重複代碼 → 300行統一實現
- [ ] 配置簡潔：僅2個參數控制所有變化
- [ ] 模版完備：覆蓋所有函數和單位組合
- [ ] 教學正確：數學邏輯完全準確
- [ ] LaTeX標準：100%符合已建立規範

## ✅ **成功標準**

### **量化指標** (整合後修正)
- **代碼減少**: 558行 → 300行以內 (46%減少)
- **重複消除**: 度數版242行 + 弧度版251行 → 統一實現
- **Pydantic移除**: 100%清除所有BaseModel
- **功能擴展**: 保持原有功能 + 難度選擇 + 統一單位切換
- **LaTeX標準**: 100%符合已建立的轉義規範

### **典範價值** (整合擴展)
- [ ] **圖形整合典範**: 展示如何正確保留有價值的圖形功能
- [ ] **特殊角優化**: 建立高效的特殊角度查詢機制
- [ ] **LaTeX應用**: 示範標準化轉義規範的實際應用
- [ ] **統一設計典範**: 展示如何優雅整合相似功能(度數/弧度)
- [ ] **難度分級範例**: 為其他生成器提供difficulty參數設計參考
- [ ] **模版適應性**: 示範純模版系統如何處理多種變體
- [ ] **教學友善**: 教師可輕鬆理解和配置三角函數生成邏輯

## 🔍 **風險評估**

### **主要風險**
1. **圖形整合複雜度**: 保留圖形功能時避免引入新的複雜性
2. **特殊角精度**: 確保三角函數值的數學正確性
3. **QuestionSize修復**: 正確恢復題目尺寸設定

### **風險控制**
1. **參考舊版**: archived版本242行已證實可行
2. **分步驗證**: 每個Phase完成後立即測試
3. **典範經驗**: 充分應用InverseTrig重寫的成功經驗

## 📅 **實施時程** (完整統一整合版)

### **與UI配置系統的協調執行**

**執行順序確認**：
1. **先執行TrigonometricFunctionGenerator統一整合** (3小時15分鐘)
   - 建立統一的生成器架構
   - 實現difficulty和angle_unit配置接口
   - 消除UI中的重複選項問題

2. **再執行UI配置系統建立** (40分鐘)
   - 為統一後的生成器提供UI配置支援
   - 驗證配置系統與實際生成器的協調效果

**協調理由**：
- 統一整合後，UI配置系統有具體的實用場景
- 避免UI配置系統成為無用的過度工程
- 確保兩個系統能完美協調工作

### **總時程**: 3小時15分鐘 (統一整合) + 40分鐘 (UI配置) = ~4小時

```
第一階段 (50分鐘): 完整統一架構重建
├── 統一參數處理 (20分鐘) - 難度+角度單位整合
├── 枚舉類完全移除 (10分鐘) - 清除Pydantic痕跡
├── 統一生成邏輯重構 (15分鐘) - 度數/弧度雙支援
└── 格式化方法統一 (5分鐘) - 雙單位自適應

第二階段 (40分鐘): 統一數據結構重建
├── 統一查詢表建構 (25分鐘) - 度數/弧度雙支援
└── 完整圖形系統整合 (15分鐘) - 自動單位轉換

第三階段 (50分鐘): 完整模版系統重建
├── 統一LaTeX格式化 (15分鐘) - 雙單位支援
└── 完整模版系統實現 (35分鐘) - 6函數×2單位×特殊情況

第四階段 (35分鐘): 完整實現與驗證
├── 完整統一實現 (25分鐘) - 無過渡期考慮
└── 典範價值確立 (10分鐘) - 統一設計標準

最終整合 (20分鐘): 完整架構收尾
├── 統一介面實現 (10分鐘) - 標準化方法
└── 典範註解實施 (10分鐘) - 基於代碼註解標準與規範
```

## 📚 **參考資源**

### **典範經驗**
- `InverseTrigonometricFunctionGenerator.py` - 教學正確性優先典範
- `docs/20250917_三角反函數生成器重寫計畫_已完成.md` - 成功方法論
- `docs/20250916_代碼註解標準與規範_已完成.md` - 註解標準與禁用模式
- `docs/20250917_防範Unicode誤用機制實施計畫_研擬中.md` - LaTeX標準

### **技術參考**
- `docs/archived/generators/trigonometry/TrigonometricFunctionGenerator.py` - 舊版簡潔實現
- `generators/algebra/double_radical_simplification.py` - 重寫典範
- `utils` 模組 - get_logger, global_config整合

## 🎯 **重寫核心理念**

### **基於已建立的典範經驗**
1. **該用基礎招式的時候用基礎招式**: f字串 vs 複雜模板
2. **教學正確性永遠優先**: 不為行數犧牲數學邏輯
3. **保留真正的價值**: 圖形整合是新版的核心優勢
4. **移除無意義的抽象**: Pydantic和枚舉增加複雜度但無實質價值

### **完整統一實現目標**
建立第二個典範生成器，與InverseTrig形成完整互補：
- **InverseTrig**: 特殊角邏輯 + LaTeX標準化典範
- **TrigonometricFunction**: 完整統一架構 + 圖形整合 + 6函數支援典範

**統一整合成就**:
- **代碼統一**: 493行重複 → 300行統一實現 (39%效率提升)
- **功能整合**: 度數版+弧度版 → 雙模式統一切換
- **配置標準**: difficulty + angle_unit 雙參數控制框架
- **模版完備**: 18個模版覆蓋所有函數和單位組合
- **UI配置**: 提供完整的動態配置選項參考

**設計典範建立**:
為後續所有生成器重寫提供統一設計、難度分級、雙模式切換的完整方法論基礎。展示如何優雅處理參數變化而不引入過度工程化。

---

**計畫狀態**: ✅ 理解確認完成 - UI整合必要性已明確
**實施方針**: 優先統一整合解決UI重複問題，再建立配置系統
**預期效果**: 消除UI重複選項 + 建立統一配置典範
**核心原則**: 解決實際UI問題、教學正確、與UI系統協調
**執行順序**: TrigonometricFunctionGenerator統一整合 → UI配置系統建立