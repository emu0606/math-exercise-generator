# 百分比對話框字體一致性與UI優化修復計畫

**日期**: 2025-09-28
**狀態**: 研擬中
**問題**: 題型配置視窗中字體大小不一致 + 進度條右側多餘百分比數字

## 🔍 問題分析

### 問題1: 字體一致性失效
- **現象**: SpinBox兩側的標題和百分比顯示字體大小與主UI不一致
- **根本原因**: 兩個技術錯誤的組合
  1. **類型錯誤**: 錯誤假設FontManager是dict而非類對象
  2. **Parent路徑錯誤**: 只檢查直接parent，未通過正確路徑到達MainWindow

### 問題2: UI冗餘資訊
- **現象**: 進度條右側顯示百分比數字（如"70%"）
- **問題**: SpinBox已有數字輸入，進度條右側的百分比是多餘資訊
- **位置**: `_create_progress_bar()` 第457行

## 🛠️ 技術修復方案

### 修復1: 字體縮放存取邏輯
```python
# ❌ 當前錯誤代碼 (第377-381行)
parent_widget = self.parent()
if parent_widget and hasattr(parent_widget, 'font_manager'):
    font_manager = getattr(parent_widget, 'font_manager')
    if isinstance(font_manager, dict) and 'current_scale' in font_manager:
        scale_factor = font_manager['current_scale']

# ✅ 修正後代碼
main_window = self.parent().parent() if self.parent() else None
if main_window and hasattr(main_window, 'font_manager'):
    font_manager = main_window.font_manager
    if hasattr(font_manager, 'current_scale'):
        scale_factor = font_manager.current_scale
```

### 修復2: 移除多餘百分比顯示
```python
# ❌ 當前代碼 (第457行)
return f"{filled_part}{empty_part} {percentage_text}"

# ✅ 修正後代碼
return f"{filled_part}{empty_part}"
```

## 📋 實施計畫

### Phase 1: 字體縮放修復 (15分鐘)
- [ ] 修正FontManager類型判斷邏輯
- [ ] 修正parent路徑存取邏輯
- [ ] 加強錯誤處理和日誌記錄

### Phase 2: UI優化 (5分鐘)
- [ ] 移除進度條右側多餘百分比數字
- [ ] 更新相關註解說明

### Phase 3: 測試驗證 (10分鐘)
- [ ] 測試字體縮放是否正常工作
- [ ] 測試進度條顯示是否簡潔
- [ ] 驗證配置功能完整性

## 🚨 風險評估

### 低風險修復
- **範圍**: 僅修改percentage_dialog.py內部實現
- **影響**: 不改變對外接口和核心邏輯
- **回滾**: 可立即回滾到原始版本

### 具體風險
1. **字體縮放修復**:
   - ✅ 風險極低: 只修正存取邏輯，不改變功能
   - ✅ 失敗退化: scale_factor=1.0，與修復前相同

2. **移除百分比數字**:
   - ✅ 風險極低: 純UI簡化，不影響功能
   - ✅ 進度條仍可視化顯示比例

### 潛在影響
- **正面**: 字體一致性改善，UI更簡潔
- **負面**: 無明顯負面影響
- **用戶體驗**: 整體改善

## 📊 成功標準

### 功能驗證
- ✅ 字體縮放跟隨主UI設定變化
- ✅ 所有文字元素字體大小一致
- ✅ 進度條簡潔無冗餘資訊
- ✅ 配置功能正常運作

### 技術指標
- ✅ FontManager.current_scale正確讀取
- ✅ 動態字體大小正確計算
- ✅ UI元素視覺層級協調

## 💼 簡報摘要

### 問題
百分比配置對話框存在兩個問題：
1. **字體不一致**: 技術邏輯錯誤導致字體縮放失效
2. **UI冗餘**: 進度條右側百分比數字與SpinBox重複

### 解決方案
1. **修正技術錯誤**: 正確存取FontManager和parent路徑
2. **簡化UI顯示**: 移除進度條右側多餘百分比

### 風險與收益
- **風險**: 極低（純內部邏輯修正）
- **收益**: 字體一致性 + UI簡潔性
- **工作量**: 30分鐘

---

**修復優先級**: 中
**預估工作量**: 30分鐘
**風險等級**: 極低
**影響範圍**: percentage_dialog.py 字體縮放和進度條顯示