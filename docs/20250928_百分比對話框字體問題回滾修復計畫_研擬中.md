# 百分比對話框字體問題回滾修復計畫

**日期**: 2025-09-28
**狀態**: 研擬中
**問題**: 過度工程化導致字體縮放問題複雜化，需要回滾到簡單解決方案

## 🤦‍♂️ 問題反思

### 錯誤做法回顧
1. **過度複雜化parent路徑**: 從`self.parent()`改為`self.parent().parent().parent()`
2. **添加手動字體設定**: 用`setStyleSheet`覆蓋FontManager的全域樣式
3. **創造新問題**: 讓simple problem變成complex problem

### 根本原因分析
- FontManager已有完整的全域CSS字體縮放系統
- SpinBox能正確縮放是因為它**沒有**手動字體設定，直接使用全域樣式
- 其他元素不能縮放是因為手動`setStyleSheet`**覆蓋了**全域樣式

## 🛠️ 回滾修復方案

### Phase 1: 移除手動字體設定 (10分鐘)
移除以下代碼中的font-size設定，保留其他樣式：

```python
# 第212行 - item_label
# 移除: font-size: {self._get_scaled_font_size(14)}px;
item_label.setStyleSheet("")  # 或完全移除setStyleSheet

# 第232行 - progress_desc
# 保留: color: #7f8c8d; margin-bottom: 8px;
# 移除: font-size: {self._get_scaled_font_size(12)}px;
progress_desc.setStyleSheet("color: #7f8c8d; margin-bottom: 8px;")

# 第238行 - total_label
# 保留: font-weight: bold; margin: 8px 0px;
# 移除: font-size: {self._get_scaled_font_size(16)}px;
self.total_label.setStyleSheet("font-weight: bold; margin: 8px 0px;")

# 第478, 483, 488行 - 動態總和顯示樣式
# 保留顏色和粗體，移除font-size
```

### Phase 2: 簡化等寬字體處理 (5分鐘)
```python
def _get_monospace_font_style(self) -> str:
    # 移除字體大小設定，只保留字體家族
    monospace_fonts = ["Consolas", "Monaco", "Courier New"]
    font_family = ", ".join([f"'{font}'" for font in monospace_fonts])
    return f"font-family: {font_family};"  # 讓FontManager控制字體大小
```

### Phase 3: 清理過時函數 (5分鐘)
如果測試確認不再需要，移除：
- `_get_scaled_font_size()` 整個函數
- 所有相關的parent路徑邏輯
- 無用的import和變數

### Phase 4: 測試驗證 (10分鐘)
- 啟動應用程式
- 打開百分比配置對話框
- 驗證所有文字元素都跟隨FontManager縮放
- 確認功能完整性不受影響

## 🎯 預期結果

### 成功標準
- ✅ 所有文字元素（標籤、按鈕、進度描述）跟隨主UI字體縮放
- ✅ SpinBox維持現有正確縮放
- ✅ 對話框功能完全正常
- ✅ 代碼更簡潔，無複雜的parent路徑邏輯

### 風險評估
- **風險**: 極低，移除覆蓋樣式讓元素使用全域樣式
- **回滾**: 如果失敗，可立即恢復手動字體設定
- **影響**: 純UI顯示改善，不影響功能邏輯

## 💡 設計理念

### 遵循「該用基礎招式的時候用基礎招式」
- FontManager的全域CSS = 基礎招式，簡單有效
- 手動setStyleSheet = 過度複雜化，應該避免

### 工程師反思
- 先試最簡單的解決方案
- 不要假設需要複雜的解決方案
- 理解現有系統再做修改
- 承認錯誤並快速修正

---

**修復優先級**: 高
**預估工作量**: 30分鐘
**風險等級**: 極低
**期望結果**: 簡潔且有效的字體縮放機制