# 統一的指數方程式生成器：架構與範例

## 目錄
1. [核心概念](#核心概念)
2. [架構設計](#架構設計)
3. [因式定義](#因式定義)
4. [題型分類](#題型分類)
5. [範例展示](#範例展示)

---

## 核心概念

### 指數方程式的本質分類

所有指數方程式的求解可以歸納為三大類：

| 題型 | 核心機制 | 難度 | 代碼邏輯 |
|------|--------|------|--------|
| **題型一** | 同底數轉換 → 比較指數 | 基礎 | 獨立的前置轉換層 |
| **題型二** | 單底數代換 → 二次因式分解 | 進階 | 統一的換元降次框架 |
| **題型三** | 多底數代換 → 分組因式分解 | 高階 | 統一的換元降次框架 |

### 統一設計的核心

**題型二和題型三在代碼層應該使用同一套機制**，差異只在於：
- 因式池中因式的**底數個數**
- 應用的**隱藏變形類型**

---

## 架構設計

### 生成器的總體結構

```
UnifiedExponentialGenerator
│
├─ Module 1: Same-Base Conversion (題型一)
│  └─ 前置轉換層（獨立邏輯）
│
├─ Module 2 & 3: Substitution & Factorization (題型二、三)
│  │
│  ├─ Step 1: Factor Pool Selection
│  │  └─ 從因式庫選擇 N 個因式
│  │
│  ├─ Step 2: Polynomial Generation
│  │  └─ 展開因式乘積 → 得到多項式
│  │
│  ├─ Step 3: Hiding Transformation (可選)
│  │  ├─ NONE: 不隱藏
│  │  ├─ SINGLE_BASE: 單底代換隱藏
│  │  └─ MULTI_BASE: 多底分組隱藏
│  │
│  └─ Step 4: Equation & Solution Generation
│     └─ 生成題目 + 解 + 詳細步驟
```

### 代碼伪代碼

```python
class UnifiedExponentialGenerator:
    
    def generate_type1(self, left_expr, right_expr, target_x):
        """
        題型一：同底數轉換
        
        Input:
          - left_expr: 左邊指數式 (如 9^(x+2))
          - right_expr: 右邊指數式 (如 (1/3)^(2x+8))
          - target_x: 目標解
        
        Process:
          1. 轉換為同底數
          2. 比較指數
          3. 求解一次方程
        
        Output: Equation + Solution + Steps
        """
        pass
    
    def generate_type2_3(self, factors: List[Factor], hide_type: str = None):
        """
        題型二、三：統一的換元降次框架
        
        Input:
          - factors: 因式列表
            * 單底數時: [Factor(base=a), Factor(base=a)]
            * 多底數時: [Factor(base=a), Factor(base=b)]
          - hide_type: 隱藏變形類型
            * None: 不隱藏，直接展開
            * 'SINGLE_BASE': 單底代換隱藏（題型二特有）
            * 'MULTI_BASE': 多底分組隱藏（題型三特有）
        
        Process:
          1. 驗證因式的實數解
          2. 展開因式乘積
          3. 應用隱藏變形（若有）
          4. 生成方程、解、詳細步驟
        
        Output: Equation + Solutions + Steps
        """
        # Step 1: 驗證因式
        solutions = [f.solution() for f in factors if f.has_real_solution()]
        
        # Step 2: 展開
        polynomial = self._expand_factors(factors)
        
        # Step 3: 隱藏變形
        if hide_type:
            polynomial = self._apply_hiding(polynomial, hide_type)
        
        # Step 4: 生成
        return self._create_equation(polynomial, solutions)
    
    def _expand_factors(self, factors: List[Factor]):
        """展開因式乘積"""
        pass
    
    def _apply_hiding(self, polynomial, hide_type):
        """應用隱藏變形"""
        pass
```

---

## 因式定義

### 因式的統一分類

所有因式只分為**兩類**：

#### 類型 I：有實數解因式

**形式**: $(a^x - k) = 0$，其中 $k > 0$

**特點**: 有唯一實數解 $x = \log_a(k)$

**例子**:
- $(2^x - 8) = 0$ → $x = 3$（因為 $2^3 = 8$）
- $(3^x - 1) = 0$ → $x = 0$（因為 $3^0 = 1$，注意這不是特例）
- $(5^x - \sqrt{5}) = 0$ → $x = 1/2$（因為 $5^{1/2} = \sqrt{5}$）
- $(2^x - 1/4) = 0$ → $x = -2$（因為 $2^{-2} = 1/4$）

#### 類型 II：無實數解因式

**形式**: $(a^x + b) = 0$，其中 $b > 0$

**特點**: 無實數解（因為 $a^x > 0$ 總是成立）

**例子**:
- $(3^x + 9) = 0$ → 無解
- $(5^x + 1) = 0$ → 無解

### 因式數據結構

```python
@dataclass
class Factor:
    base: int              # 底數 (如 2, 3, 5)
    var: str               # 變數名 (如 'x', 'y')
    target: Rational       # 目標值 k
    
    def has_real_solution(self) -> bool:
        """判斷是否有實數解"""
        return self.target > 0
    
    def solution(self) -> Optional[Rational]:
        """計算解 x 使得 base^x = target"""
        if not self.has_real_solution():
            return None
        # 計算 log_base(target)
        # 例：Factor(base=2, target=8).solution() → 3
        pass
    
    def __str__(self) -> str:
        """因式的字符串表示"""
        if self.target > 0:
            return f"({self.base}^{self.var} - {self.target})"
        else:
            return f"({self.base}^{self.var} + {abs(self.target)})"
```

---

## 題型分類

### 題型一：同底數轉換題型

#### 核心機制

將方程式中的各項化為相同底數，然後通過比較指數來求解。

#### 特點

- 不涉及二次代換
- 最終求解一次方程式
- 屬於前置轉換層

#### 範例 1.1：基礎形式

**參數**:
- 底數 $c = 3$，偏移量 $p = 2$，$q = -1$，$m = 1$，$n = 2$，$k = 2$，$l = 8$
- 目標解 $x = -3$

**生成過程**:
1. 計算 $a = 3^2 = 9$，$b = 3^{-1} = 1/3$
2. 方程式：$9^{x+2} = (1/3)^{2x+8}$

**詳解**:
1. $9^{x+2} = (1/3)^{2x+8}$
2. $(3^2)^{x+2} = (3^{-1})^{2x+8}$
3. $3^{2(x+2)} = 3^{-1(2x+8)}$
4. 比較指數：$2(x+2) = -1(2x+8)$
5. $2x + 4 = -2x - 8$
6. $4x = -12$
7. $x = -3$

#### 範例 1.2：鏈式求解

**參數**:
- 關係一：$32^x = 8$
- 關係二：$81^y = 27^x$

**詳解**:
1. 從 $32^x = 8$ 開始：$(2^5)^x = 2^3 \Rightarrow 5x = 3 \Rightarrow x = 3/5$
2. 代入第二式：$81^y = 27^{3/5}$
3. $(3^4)^y = (3^3)^{3/5} \Rightarrow 3^{4y} = 3^{9/5}$
4. 比較指數：$4y = 9/5 \Rightarrow y = 9/20$

---

### 題型二、三：換元降次題型（統一框架）

#### 核心機制

通過因式分解和代換，將複雜的指數方程轉化為更簡單的形式。

#### 共同流程

```
Step 1: 選擇因式
        因式 1: Factor(base=a, ...)
        因式 2: Factor(base=b, ...)  （b 可以等於 a）

Step 2: 展開因式乘積
        (a^x - k₁)(b^x - k₂) = 0 → 多項式

Step 3: 隱藏變形（可選）
        依據題型決定是否隱藏、如何隱藏

Step 4: 生成題目
        展示隱藏後的形式 → 學生需要因式分解回溯
```

#### 題型二：單底數代換

**特點**:
- 兩個因式的底數相同
- 隱藏形式：通過代換 $y = a^x$ 後的二次式
- 形式可能經過係數重組或指數變換隱藏

**範例 2.1：標準二次代換**

**因式選擇**:
- 因式 1：$Factor(base=2, var='x', target=2)$ → $2^x = 2 \Rightarrow x = 1$
- 因式 2：$Factor(base=2, var='x', target=8)$ → $2^x = 8 \Rightarrow x = 3$

**展開過程**:
1. $(2^x - 2)(2^x - 8) = 0$
2. 令 $y = 2^x$：$(y - 2)(y - 8) = 0$
3. $y^2 - 10y + 16 = 0$

**隱藏變形 (SINGLE_BASE)**:
- 替換 $y = 2^x$：$(2^x)^2 - 10 \cdot 2^x + 16 = 0$
- 替換 $2^x = 4^{x/2}$：$4^x - 5 \cdot 2^{x+1} + 16 = 0$（進一步隱藏）

**題目**:
$$4^x - 5 \cdot 2^{x+1} + 16 = 0$$

**詳解**:
1. 令 $y = 2^x$，則 $4^x = (2^2)^x = (2^x)^2 = y^2$，$2^{x+1} = 2 \cdot 2^x = 2y$
2. 原方程變為：$y^2 - 5(2y) + 16 = 0$
3. $y^2 - 10y + 16 = 0$
4. $(y - 2)(y - 8) = 0$
5. $y = 2$ 或 $y = 8$
6. $2^x = 2 \Rightarrow x = 1$；$2^x = 8 \Rightarrow x = 3$

---

#### 題型三：多底數分組

**特點**:
- 兩個因式的底數不同
- 隱藏形式：展開後的四項式需要分組才能回到因式
- 形式為 $a_1 b_1^x + a_2 b_1^x + a_3 b_2^x + a_4 b_2^x = 0$ 的分組形式

**範例 3.1：展開後的多底數形式**

**因式選擇**:
- 因式 1：$Factor(base=5, var='x', target=5)$ → $5^x = 5 \Rightarrow x = 1$
- 因式 2：$Factor(base=2, var='x', target=4)$ → $2^x = 4 \Rightarrow x = 2$

**展開過程**:
1. $(5^x - 5)(2^x - 4) = 0$
2. 展開：$5^x \cdot 2^x - 4 \cdot 5^x - 5 \cdot 2^x + 20 = 0$
3. 整理：$(5 \cdot 2)^x - 4 \cdot 5^x - 5 \cdot 2^x + 20 = 0$
4. 即：$10^x - 4 \cdot 5^x - 5 \cdot 2^x + 20 = 0$

**隱藏變形 (MULTI_BASE)**:
- 直接展開，不進一步簡化
- 學生需要分組識別因式結構

**題目**:
$$10^x - 4 \cdot 5^x - 5 \cdot 2^x + 20 = 0$$

**詳解**:
1. 分組：$(10^x - 4 \cdot 5^x) - (5 \cdot 2^x - 20) = 0$
2. 第一組提 $5^x$：$5^x(2^x - 4) - 5(2^x - 4) = 0$
3. 提取公因式 $(2^x - 4)$：$(5^x - 5)(2^x - 4) = 0$
4. $5^x - 5 = 0 \Rightarrow 5^x = 5 \Rightarrow x = 1$
5. $2^x - 4 = 0 \Rightarrow 2^x = 4 \Rightarrow x = 2$

---

## 範例展示

### 完整範例集合

#### 範例 A：題型二 - 包含無解因式

**因式選擇**:
- 因式 1：$Factor(base=2, var='x', target=8)$ → $2^x = 8 \Rightarrow x = 3$
- 因式 2：$Factor(base=2, var='x', target=-4)$ → 無實數解

**展開過程**:
1. $(2^x - 8)(2^x + 4) = 0$
2. 令 $y = 2^x$：$(y - 8)(y + 4) = 0$
3. $y^2 - 4y - 32 = 0$

**題目**:
$$2^{2x} - 4 \cdot 2^x - 32 = 0$$

**詳解**:
1. 令 $y = 2^x$，則 $2^{2x} = y^2$
2. 原方程變為：$y^2 - 4y - 32 = 0$
3. $(y - 8)(y + 4) = 0$
4. $y = 8$ 或 $y = -4$
5. $2^x = 8 \Rightarrow x = 3$（$2^x = -4$ 無實數解）
6. **最終答案**：$x = 3$

#### 範例 B：題型三 - 多層隱藏

**因式選擇**:
- 因式 1：$Factor(base=3, var='x', target=27)$ → $3^x = 27 \Rightarrow x = 3$
- 因式 2：$Factor(base=2, var='x', target=2)$ → $2^x = 2 \Rightarrow x = 1$

**展開過程**:
1. $(3^x - 27)(2^x - 2) = 0$
2. 展開：$3^x \cdot 2^x - 2 \cdot 3^x - 27 \cdot 2^x + 54 = 0$
3. 整理：$6^x - 2 \cdot 3^x - 27 \cdot 2^x + 54 = 0$

**題目**:
$$6^x - 2 \cdot 3^x - 27 \cdot 2^x + 54 = 0$$

**詳解**:
1. 分組：$(6^x - 2 \cdot 3^x) - (27 \cdot 2^x - 54) = 0$
2. 第一組提 $3^x$：$3^x(2^x - 2) - 27(2^x - 2) = 0$
3. 提取公因式 $(2^x - 2)$：$(3^x - 27)(2^x - 2) = 0$
4. $3^x - 27 = 0 \Rightarrow 3^x = 27 \Rightarrow x = 3$
5. $2^x - 2 = 0 \Rightarrow 2^x = 2 \Rightarrow x = 1$

---

## 總結表格

| 維度 | 題型一 | 題型二 | 題型三 |
|------|-------|-------|-------|
| **核心機制** | 同底轉換 + 比較指數 | 單底代換 + 二次分解 | 多底代換 + 分組分解 |
| **因式數量** | N/A | 2 | 2 |
| **因式底數** | N/A | 相同 | 不同 |
| **隱藏形式** | N/A | SINGLE_BASE | MULTI_BASE |
| **代碼邏輯** | 獨立 | 統一框架 | 統一框架 |
| **難度** | 基礎 | 進階 | 高階 |

---

## 架構優勢

1. **代碼複用性高**：題型二和題型三使用同一套 `generate_type2_3()` 方法
2. **擴展性強**：新增題型只需添加新的因式或隱藏方式
3. **因式定義統一**：只有兩類因式，降低複雜度
4. **參數化明確**：所有變化都可通過參數控制