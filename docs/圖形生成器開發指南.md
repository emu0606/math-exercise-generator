# åœ–å½¢ç”Ÿæˆå™¨é–‹ç™¼æŒ‡å—

## æ¦‚è¿°

### åœ–å½¢ç”Ÿæˆå™¨çš„è§’è‰²
åœ–å½¢ç”Ÿæˆå™¨æ˜¯æ•¸å­¸æ¸¬é©—ç³»çµ±çš„åœ–å½¢çµ„ä»¶ï¼Œè² è²¬ç‚ºæ•¸å­¸é¡Œç›®ç”Ÿæˆå°æ‡‰çš„ TikZ åœ–å½¢ä»£ç¢¼ã€‚ç•¶é¡Œç›®ç”Ÿæˆå™¨ç”¢ç”Ÿä¸€é“å¹¾ä½•é¡Œã€ä¸‰è§’å‡½æ•¸é¡Œæˆ–å…¶ä»–éœ€è¦åœ–å½¢è¼”åŠ©çš„æ•¸å­¸å•é¡Œæ™‚ï¼Œåœ–å½¢ç”Ÿæˆå™¨æä¾›åƒæ•¸åŒ–çš„è¦–è¦ºåŒ–æ”¯æ´ã€‚

### èˆ‡é¡Œç›®ç”Ÿæˆå™¨çš„é—œä¿‚
- **åƒæ•¸åŒ–é…åˆ**ï¼šåœ–å½¢åƒæ•¸èˆ‡é¡Œç›®æ•¸å€¼åŒæ­¥è®ŠåŒ–
- **æ ¼å¼çµ±ä¸€**ï¼šæ‰€æœ‰åœ–å½¢è¼¸å‡ºæ¨™æº–åŒ–çš„ TikZ ä»£ç¢¼
- **è®Šé«”æ”¯æ´**ï¼šåŒä¸€åœ–å½¢å¯ç”¢ç”Ÿé¡Œç›®ç‰ˆå’Œè§£ç­”ç‰ˆ

### æ ¸å¿ƒåƒ¹å€¼
- **ä¸€è‡´æ€§**ï¼šçµ±ä¸€çš„è¦–è¦ºé¢¨æ ¼å’Œä»£ç¢¼è¦ç¯„
- **åƒæ•¸åŒ–**ï¼šå‹•æ…‹èª¿æ•´åœ–å½¢å…§å®¹é…åˆä¸åŒé¡Œç›®
- **è‡ªå‹•åŒ–**ï¼šæ¸›å°‘æ‰‹å·¥ç¹ªåœ–ï¼Œæå‡ç”Ÿæˆæ•ˆç‡

## æ ¸å¿ƒæ¦‚å¿µ

### é¡Œç›®èˆ‡è§£ç­”è®Šé«”
åœ–å½¢ç”Ÿæˆå™¨çš„ä¸€å€‹é—œéµç‰¹è‰²æ˜¯æ”¯æ´å…©ç¨®é¡¯ç¤ºè®Šé«”ï¼š

#### Question è®Šé«”ï¼ˆé¡Œç›®åœ–ï¼‰
- **ç›®çš„**ï¼šæä¾›è¶³å¤ è³‡è¨Šè®“å­¸ç”Ÿç†è§£é¡Œç›®ï¼Œä½†ä¸æ´©æ¼ç­”æ¡ˆ
- **ç‰¹é»**ï¼šæœ€å°‘å¿…è¦è³‡è¨Šï¼Œéš±è—è§£ç­”ç›¸é—œçš„æ¨™è¨»
- **ä¾‹å­**ï¼šå–®ä½åœ“åªé¡¯ç¤ºåœ“å‘¨å’Œè§’åº¦æ¨™è¨˜ï¼Œä¸é¡¯ç¤ºåº§æ¨™å€¼

#### Explanation è®Šé«”ï¼ˆè§£ç­”åœ–ï¼‰
- **ç›®çš„**ï¼šæä¾›å®Œæ•´è³‡è¨Šè¼”åŠ©èªªæ˜è§£é¡Œéç¨‹
- **ç‰¹é»**ï¼šé¡¯ç¤ºæ‰€æœ‰ç›¸é—œæ•¸å€¼ã€æ¨™è¨»ã€è¼”åŠ©ç·šç­‰
- **ä¾‹å­**ï¼šå–®ä½åœ“é¡¯ç¤ºå®Œæ•´åº§æ¨™ã€ä¸‰è§’å‡½æ•¸å€¼ã€æŠ•å½±ç·šç­‰

```python
# è®Šé«”ä½¿ç”¨ç¯„ä¾‹
params = {
    'angle': 60,
    'variant': 'question'    # æˆ– 'explanation'
}
```

### åƒæ•¸æ¨¡å‹ç³»çµ±
ä½¿ç”¨ Pydantic å»ºç«‹å‹åˆ¥å®‰å…¨çš„åƒæ•¸é©—è­‰ï¼š

```python
from figures.params.base import BaseFigureParams
from pydantic import Field

class MyFigureParams(BaseFigureParams):
    radius: float = Field(default=1.0, gt=0, description="åœ“çš„åŠå¾‘")
    center_x: float = Field(default=0.0, description="åœ“å¿ƒ x åº§æ¨™")
    center_y: float = Field(default=0.0, description="åœ“å¿ƒ y åº§æ¨™")
```

### è¨»å†Šæ©Ÿåˆ¶
ä½¿ç”¨è£é£¾å™¨å°‡ç”Ÿæˆå™¨è¨»å†Šåˆ°ç³»çµ±ï¼š

```python
from figures import register_figure_generator

@register_figure_generator
class MyFigureGenerator(FigureGenerator):
    @classmethod
    def get_name(cls) -> str:
        return 'my_figure_type'
```

## é–‹ç™¼å¯¦ä½œ

### åƒæ•¸æ¨¡å‹è¨­è¨ˆ

#### åŸºæœ¬çµæ§‹
æ‰€æœ‰åƒæ•¸æ¨¡å‹éƒ½éœ€è¦ç¹¼æ‰¿ `BaseFigureParams`ï¼š

```python
from figures.params.base import BaseFigureParams
from pydantic import Field
from typing import Literal

class CircleParams(BaseFigureParams):
    radius: float = Field(default=1.0, gt=0, description="åŠå¾‘")
    center_x: float = Field(default=0.0, description="åœ“å¿ƒ x åº§æ¨™")
    center_y: float = Field(default=0.0, description="åœ“å¿ƒ y åº§æ¨™")
    fill: bool = Field(default=False, description="æ˜¯å¦å¡«å……")
    line_color: str = Field(default='black', description="ç·šæ¢é¡è‰²")
```

#### è®Šé«”æ¬„ä½è™•ç†
`BaseFigureParams` å·²åŒ…å« `variant` æ¬„ä½ï¼Œç„¡éœ€é‡è¤‡å®šç¾©ï¼š

```python
# åœ¨ generate_tikz æ–¹æ³•ä¸­ä½¿ç”¨
def generate_tikz(self, params: Dict[str, Any]) -> str:
    validated_params = CircleParams(**params)

    if validated_params.variant == 'explanation':
        # é¡¯ç¤ºé¡å¤–çš„è§£ç­”è³‡è¨Š
        pass
    else:
        # é¡¯ç¤ºåŸºæœ¬çš„é¡Œç›®è³‡è¨Š
        pass
```

### ç”Ÿæˆå™¨å¯¦ä½œ

#### åŸºæœ¬çµæ§‹
```python
from figures.base import FigureGenerator
from utils import get_logger
from typing import Dict, Any

@register_figure_generator
class CircleGenerator(FigureGenerator):

    def __init__(self):
        super().__init__()
        self.logger = get_logger(self.__class__.__name__)

    @classmethod
    def get_name(cls) -> str:
        return 'circle'

    def generate_tikz(self, params: Dict[str, Any]) -> str:
        # åƒæ•¸é©—è­‰
        validated_params = CircleParams(**params)

        # ç”Ÿæˆ TikZ ä»£ç¢¼
        tikz_code = self._build_circle_tikz(validated_params)

        return tikz_code
```

#### éŒ¯èª¤è™•ç†
```python
from pydantic import ValidationError

def generate_tikz(self, params: Dict[str, Any]) -> str:
    try:
        validated_params = CircleParams(**params)
    except ValidationError as e:
        self.logger.error(f"åƒæ•¸é©—è­‰å¤±æ•—: {str(e)}")
        raise ValueError(f"åœ“å½¢åƒæ•¸é©—è­‰å¤±æ•—: {str(e)}")

    # ç¹¼çºŒè™•ç†...
```

### æ•¸å­¸è¨ˆç®—æ”¯æ´

#### ä½¿ç”¨ utils.geometry æ¨¡çµ„
ç³»çµ±æä¾›å®Œæ•´çš„å¹¾ä½•è¨ˆç®—å·¥å…·ï¼Œé¿å…é‡è¤‡å¯¦ä½œåŸºç¤æ•¸å­¸é‹ç®—ï¼š

```python
from utils import Point, Triangle, distance, angle_between
import utils.geometry as geom

# é»é‹ç®—
point_a = Point(0, 0)
point_b = Point(3, 4)
dist = distance(point_a, point_b)  # è¿”å› 5.0

# ä¸‰è§’å½¢è¨ˆç®—
triangle = Triangle(Point(0, 0), Point(3, 0), Point(1.5, 2.6))
area = triangle.area()  # è¨ˆç®—é¢ç©
perimeter = triangle.perimeter()  # è¨ˆç®—å‘¨é•·
side_lengths = triangle.side_lengths()  # ç²å–ä¸‰é‚Šé•·åº¦

# è§’åº¦è¨ˆç®—
angle = angle_at_vertex(point_a, point_b, Point(5, 0))
```

#### å¸¸ç”¨è¨ˆç®—åŠŸèƒ½
- **é»é‹ç®—**ï¼šåº§æ¨™è®Šæ›ã€è·é›¢è¨ˆç®—ã€è§’åº¦é‹ç®—
- **ç·šæ®µé‹ç®—**ï¼šé•·åº¦ã€æ–œç‡ã€äº¤é»è¨ˆç®—
- **åœ“å½¢é‹ç®—**ï¼šåœ“å‘¨ä¸Šçš„é»ã€åˆ‡ç·šã€å¼¦é•·è¨ˆç®—
- **ä¸‰è§’å½¢é‹ç®—**ï¼šé¢ç©ã€å‘¨é•·ã€é‚Šé•·ã€é‡å¿ƒè¨ˆç®—

## TikZ ç”Ÿæˆè¦é»

### åŸºæœ¬çµæ§‹
```python
def _build_circle_tikz(self, params: CircleParams) -> str:
    tikz_lines = []

    # åœ“å½¢ä¸»é«”
    circle_cmd = f"\\draw[color={params.line_color}] ({params.center_x},{params.center_y}) circle ({params.radius});"
    tikz_lines.append(circle_cmd)

    # æ ¹æ“šè®Šé«”æ·»åŠ é¡å¤–å…ƒç´ 
    if params.variant == 'explanation':
        # æ·»åŠ ä¸­å¿ƒé»
        center_cmd = f"\\fill ({params.center_x},{params.center_y}) circle (0.05);"
        tikz_lines.append(center_cmd)

    return '\n'.join(tikz_lines)
```

### åº§æ¨™ç³»çµ±
- TikZ ä½¿ç”¨ç¬›å¡çˆ¾åº§æ¨™ç³»
- å–®ä½é€šå¸¸ç‚ºå…¬åˆ† (cm)
- åº§æ¨™æ ¼å¼ï¼š`(x,y)`

### å¸¸ç”¨åœ–å½¢å…ƒç´ 
```python
# é»
"\\fill (x,y) circle (0.05);"

# ç·šæ®µ
"\\draw (x1,y1) -- (x2,y2);"

# åœ“
"\\draw (center_x,center_y) circle (radius);"

# å¼§ç·š
"\\draw (center_x,center_y) ++(start_angle:radius) arc (start_angle:end_angle:radius);"

# æ¨™ç±¤
"\\node at (x,y) {text};"
```

### é¡è‰²å’Œæ¨£å¼
```python
# é¡è‰²
"\\draw[color=red] ..."
"\\draw[blue] ..."

# ç·šæ¢æ¨£å¼
"\\draw[dashed] ..."
"\\draw[thick] ..."
"\\draw[->] ..."  # ç®­é ­
```

## æœ€ä½³å¯¦è¸

### åƒæ•¸è¨­è¨ˆåŸå‰‡
1. **åˆç†é è¨­å€¼**ï¼šè®“ç”Ÿæˆå™¨åœ¨æœ€å°‘åƒæ•¸ä¸‹ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ
2. **æ¸…æ¥šå‘½å**ï¼šåƒæ•¸åç¨±æ‡‰è©²ä¸€ç›®äº†ç„¶
3. **é©ç•¶é©—è­‰**ï¼šä½¿ç”¨ Pydantic çš„é©—è­‰åŠŸèƒ½é˜²æ­¢ç„¡æ•ˆè¼¸å…¥
4. **æ–‡æª”å®Œæ•´**ï¼šæ¯å€‹åƒæ•¸éƒ½è¦æœ‰ description

### ä»£ç¢¼çµ„ç¹”
1. **æ–¹æ³•åˆ†å‰²**ï¼šå°‡è¤‡é›œçš„ TikZ ç”Ÿæˆé‚è¼¯æ‹†åˆ†ç‚ºç§æœ‰æ–¹æ³•
2. **å¸¸æ•¸å®šç¾©**ï¼šå°‡é‡è¤‡ä½¿ç”¨çš„æ•¸å€¼å®šç¾©ç‚ºé¡åˆ¥å¸¸æ•¸
3. **æ—¥èªŒä½¿ç”¨**ï¼šåœ¨é—œéµæ­¥é©Ÿè¨˜éŒ„æ—¥èªŒï¼Œä¾¿æ–¼é™¤éŒ¯

### æ¸¬è©¦é©—è­‰
```python
# åŸºæœ¬åŠŸèƒ½æ¸¬è©¦
def test_circle_generation():
    generator = CircleGenerator()
    params = {'radius': 2.0, 'center_x': 1.0, 'center_y': 1.0}
    result = generator.generate_tikz(params)
    assert 'circle (2.0)' in result

# è®Šé«”æ¸¬è©¦
def test_circle_variants():
    generator = CircleGenerator()

    # æ¸¬è©¦é¡Œç›®è®Šé«”
    question_params = {'radius': 1.0, 'variant': 'question'}
    question_result = generator.generate_tikz(question_params)

    # æ¸¬è©¦è§£ç­”è®Šé«”
    explanation_params = {'radius': 1.0, 'variant': 'explanation'}
    explanation_result = generator.generate_tikz(explanation_params)

    # è§£ç­”åœ–æ‡‰è©²æœ‰æ›´å¤šå…ƒç´ 
    assert len(explanation_result) > len(question_result)
```

## åƒè€ƒè³‡æº

### å¯ç”¨åŸºç¤åœ–å½¢
è©³ç´°çš„åœ–å½¢é¡å‹å’Œåƒæ•¸èªªæ˜è«‹åƒè€ƒ [`available_figures.md`](available_figures.md)ã€‚

å¸¸ç”¨çš„åŸºç¤åœ–å½¢åŒ…æ‹¬ï¼š
- **é»**ï¼šåŸºæœ¬åº§æ¨™é»
- **ç·šæ®µ**ï¼šç›´ç·šå’Œæ›²ç·š
- **åœ“å½¢**ï¼šåœ“å‘¨å’Œå¡«å……åœ“
- **å¤šé‚Šå½¢**ï¼šä¸‰è§’å½¢ã€çŸ©å½¢ç­‰
- **å¼§ç·š**ï¼šè§’åº¦æ¨™è¨˜å’Œæ‰‡å½¢
- **æ¨™ç±¤**ï¼šæ–‡å­—èªªæ˜

### æ•…éšœæ’é™¤

#### å¸¸è¦‹éŒ¯èª¤
1. **åƒæ•¸é©—è­‰å¤±æ•—**ï¼šæª¢æŸ¥åƒæ•¸å‹åˆ¥å’Œç¯„åœ
2. **TikZ èªæ³•éŒ¯èª¤**ï¼šç¢ºèªæ‹¬è™Ÿå’Œåˆ†è™Ÿçš„æ­£ç¢ºä½¿ç”¨
3. **åº§æ¨™è¶…å‡ºç¯„åœ**ï¼šæª¢æŸ¥åœ–å½¢æ˜¯å¦åœ¨åˆç†çš„åº§æ¨™ç¯„åœå…§

#### é™¤éŒ¯æŠ€å·§
1. **ä½¿ç”¨æ—¥èªŒ**ï¼šåœ¨é—œéµæ­¥é©Ÿè¼¸å‡ºä¸­é–“çµæœ
2. **åˆ†æ®µæ¸¬è©¦**ï¼šå…ˆæ¸¬è©¦åŸºæœ¬åœ–å½¢ï¼Œå†æ·»åŠ è¤‡é›œå…ƒç´ 
3. **é©—è­‰ TikZ**ï¼šå°‡ç”Ÿæˆçš„ä»£ç¢¼æ”¾å…¥ LaTeX æ–‡æª”ä¸­ç·¨è­¯æ¸¬è©¦

### é€²éšä¸»é¡Œ

#### è¤‡åˆåœ–å½¢ç”Ÿæˆå™¨
å°æ–¼è¤‡é›œåœ–å½¢ï¼Œå¯ä»¥ä½¿ç”¨ `CompositeFigureGenerator` çµ„åˆå¤šå€‹åŸºç¤åœ–å½¢ï¼š

```python
# åƒè€ƒ figures/predefined/standard_unit_circle.py çš„å¯¦ä½œ
composite_params = CompositeParams(
    sub_figures=[
        SubFigureParams(id="circle", type="circle", params={...}),
        SubFigureParams(id="point", type="point", params={...}),
    ]
)
```

#### è‡ªè¨‚ TikZ æ¨£å¼
å¯ä»¥å®šç¾©å°ˆç”¨çš„ TikZ æ¨£å¼ä¾†ä¿æŒè¦–è¦ºä¸€è‡´æ€§ï¼š

```python
tikz_styles = """
\\tikzset{
    math_point/.style={fill=red, circle, inner sep=1pt},
    math_line/.style={thick, blue},
}
"""
```

## é–‹ç™¼å®Œæˆå¾Œçš„æ–‡æª”æ›´æ–°

### ğŸ“ é‡è¦æé†’ï¼šæ›´æ–°åœ–å½¢é¡å‹æ–‡æª”

ç•¶ä½ å®Œæˆæ–°åœ–å½¢ç”Ÿæˆå™¨çš„é–‹ç™¼å¾Œï¼Œ**å‹™å¿…**æ›´æ–°ç³»çµ±æ–‡æª”ï¼š

#### 1. æ›´æ–° available_figures.md
åœ¨ [`docs/available_figures.md`](available_figures.md) ä¸­æ·»åŠ ä½ çš„æ–°åœ–å½¢é¡å‹ï¼š

```markdown
### X. ä½ çš„åœ–å½¢åç¨± (`your_figure_type`)

ç°¡çŸ­æè¿°ä½ çš„åœ–å½¢ç”¨é€”å’Œç‰¹è‰²ã€‚

**åƒæ•¸**ï¼š
```python
{
    'variant': 'question',  # æˆ– 'explanation'
    'your_param_1': 'default_value',
    'your_param_2': 42,
    # ... å…¶ä»–åƒæ•¸
}
```

**ç¤ºä¾‹**ï¼š
```python
'figure_data_question': {
    'type': 'your_figure_type',
    'params': {
        'variant': 'question',
        'your_param_1': 'example_value'
    },
    'options': {
        'scale': 1.0  # å¯é¸
    }
}
```
```

#### 2. æ–‡æª”æ›´æ–°æª¢æŸ¥æ¸…å–®
- [ ] æ·»åŠ åœ–å½¢é¡å‹åˆ° `available_figures.md`
- [ ] æä¾›å®Œæ•´çš„åƒæ•¸èªªæ˜å’Œé è¨­å€¼
- [ ] åŒ…å«å¯¦ç”¨çš„ä½¿ç”¨ç¯„ä¾‹
- [ ] èªªæ˜ question/explanation è®Šé«”çš„å·®ç•°
- [ ] å¦‚æœæ˜¯è¤‡åˆåœ–å½¢ï¼Œèªªæ˜å­åœ–å½¢çµ„æˆ

#### 3. æ¸¬è©¦æ–‡æª”ç¯„ä¾‹
ç¢ºä¿ä½ åœ¨æ–‡æª”ä¸­æä¾›çš„ç¯„ä¾‹ä»£ç¢¼èƒ½å¤ æ­£å¸¸é‹è¡Œï¼š

```python
# æ¸¬è©¦ä½ çš„æ–‡æª”ç¯„ä¾‹
from figures import get_figure_generator

generator_class = get_figure_generator('your_figure_type')
generator = generator_class()
result = generator.generate_tikz({
    'variant': 'question',
    # ä½¿ç”¨æ–‡æª”ä¸­çš„åƒæ•¸ç¯„ä¾‹
})
print("âœ… æ–‡æª”ç¯„ä¾‹æ¸¬è©¦é€šé")
```

é€™æ¨£ç¢ºä¿å…¶ä»–é–‹ç™¼è€…å’Œä½¿ç”¨è€…èƒ½å¤ ï¼š
1. å¿«é€Ÿç™¼ç¾ä½ çš„æ–°åœ–å½¢é¡å‹
2. ç†è§£å¦‚ä½•æ­£ç¢ºä½¿ç”¨åƒæ•¸
3. åƒè€ƒå¯¦éš›å¯é‹è¡Œçš„ç¨‹å¼ç¢¼ç¯„ä¾‹