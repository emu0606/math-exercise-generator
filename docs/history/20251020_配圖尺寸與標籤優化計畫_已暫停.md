# 配圖尺寸與標籤優化計畫

- **計畫編號**: 20251020-Fix-Figure-Size-Labels
- **建立日期**: 2025-10-20
- **狀態**: 研擬中

## 1. 問題分析

### 當前問題

1. **圖形太大超出框線** (P0)
   - 原因：`\resizebox{\linewidth}{!}{...}` 讓圖形填滿整個 tcolorbox 寬度
   - 影響：圖形超出詳解框的藍色邊框，視覺效果不佳

2. **標籤文字太小** (P1)
   - 原因：圖形尺寸設定為 `12cm x 8cm`，當被 resize 縮小時，標籤也跟著縮小
   - 影響：標籤難以閱讀

3. **標籤離點太近** (P2)
   - 原因：position 使用簡單的 'below'，沒有設定偏移距離
   - 影響：標籤文字與點重疊或太近

## 2. 解決方案

### 方案 A：調整 LaTeX 層面的縮放比例（推薦）

**優點**：
- 快速修復，不需要調整所有生成器
- 統一控制所有圖形的顯示大小
- 易於微調

**缺點**：
- 需要測試不同題型的效果

**實施步驟**：
1. 修改 `utils/latex/generator.py:562` 的 `\resizebox` 參數
2. 將 `\linewidth` 改為 `0.8\linewidth` 或 `0.75\linewidth`
3. 添加垂直間距確保圖形不會太靠近文字

```latex
# 修改前
bottom_figure = f"\\resizebox{{\\linewidth}}{{!}}{{{figure_content}}}"
inner_content = f"{explanation_text_only}\n\\par\\medskip\\centering\n{bottom_figure}"

# 修改後
bottom_figure = f"\\resizebox{{0.75\\linewidth}}{{!}}{{{figure_content}}}"
inner_content = f"{explanation_text_only}\n\\par\\bigskip\\centering\n{bottom_figure}"
```

### 方案 B：調整圖形原始尺寸

**優點**：
- 更精確控制圖形大小
- 標籤文字不會因縮放而變小

**缺點**：
- 需要修改所有使用 function_plot 的生成器
- 維護成本較高

**實施步驟**：
1. 修改 `quadratic_extremum.py` 中的 `figure_width` 和 `figure_height`
2. 將 `12cm x 8cm` 改為 `9cm x 6cm`
3. 調整標籤位置參數

### 方案 C：增加標籤字體大小和偏移

**優點**：
- 直接解決標籤可讀性問題
- 不影響圖形整體大小

**缺點**：
- 需要在每個生成器中設定
- 需要測試不同位置的標籤

**實施步驟**：
1. 在 `plot_labels` 中添加 `font_size` 參數
2. 調整 position 為更具體的偏移，如 'below=5pt'
3. 檢查 FunctionPlotGenerator 是否支持這些參數

## 3. 推薦方案：組合方案 A + C

**執行順序**：
1. **立即修正**：調整 LaTeX 層面的縮放比例（方案 A）
2. **後續優化**：如果標籤仍然太小，添加字體大小參數（方案 C）

**預期效果**：
- 圖形大小適中，不超出框線
- 標籤清晰可讀
- 標籤與點有適當間距

## 4. 實施計畫

### 階段一：LaTeX 層面修正（立即執行）

**步驟 1.1**：調整 bottom 佈局的圖形寬度
- 檔案：`utils/latex/generator.py`
- 行號：562-563
- 修改：將 `\linewidth` 改為 `0.75\linewidth`
- 增加間距：將 `\medskip` 改為 `\bigskip`

**步驟 1.2**：測試效果
- 生成二次函數極值題目
- 檢查圖形是否在框線內
- 確認標籤清晰度

### 階段二：標籤優化（視需要執行）

**步驟 2.1**：檢查 FunctionPlotGenerator 支持的標籤參數
- 確認是否支持 `font_size`
- 確認 position 的詳細格式

**步驟 2.2**：調整標籤配置
- 如果標籤仍太小，增加原始圖形尺寸或字體大小
- 調整 position 為更明確的偏移

## 5. 驗證標準

**成功標準**：
- ✅ 圖形完全在詳解框的藍色邊框內
- ✅ 標籤文字清晰可讀（視覺上至少與正文大小相當）
- ✅ 標籤與點之間有適當間距（不重疊、不過近）
- ✅ 不同題型（全域極值、區間極值）效果一致

**測試案例**：
1. 全域極值題型
2. 頂點在區間內題型
3. 頂點在區間外題型

## 6. 風險評估

**低風險**：
- LaTeX 縮放比例調整是向後相容的
- 只影響 explanation_figure_position = 'bottom' 的情況
- 其他題型不受影響

**需要注意**：
- 確認 multicols 環境中圖形寬度的計算
- 測試長文字標籤的顯示效果
