# é¡Œç›®æ ¼å­å³é‚Šç•Œè¶…å‡ºå•é¡Œ - æ·±åº¦åˆ†æ

> **æ—¥æœŸ**: 2025-10-19
> **å•é¡Œ**: é¡Œç›®æ–‡å­—æœ‰æ™‚æœƒè¶…å‡ºæ ¼å­å³é‚Šç•Œ
> **ç‹€æ…‹**: ç ”æ“¬ä¸­ - éœ€è¬¹æ…è¾¨è­‰

---

## ğŸ“ å•é¡Œä½ç½®

**æª”æ¡ˆ**: `utils/latex/generator.py`
**æ–¹æ³•**: `generate_question_tex()` (ç¬¬51-181è¡Œ)
**é—œéµä»£ç¢¼**: ç¬¬133-169è¡Œ

---

## ğŸ” TikZ Node å¯¬åº¦æ©Ÿåˆ¶æ·±åº¦åˆ†æ

### **é—œéµæ¦‚å¿µè¾¨æ**

#### **TikZ node çš„ `text width` å±¬æ€§**

æ ¹æ“š TikZ å®˜æ–¹æ–‡æª”ï¼š
```latex
\node[text width=4cm, inner sep=0.2cm] {...}
```

**é‡è¦äº‹å¯¦**ï¼š
- `text width` æŒ‡å®šçš„æ˜¯**æ–‡å­—å…§å®¹å€åŸŸçš„å¯¬åº¦**
- `inner sep` æ˜¯**é¡å¤–æ·»åŠ **çš„å…§é‚Šè·
- ç¯€é»çš„**ç¸½å¯¬åº¦** = `text width` + 2 Ã— `inner sep`ï¼ˆå·¦å³å„ä¸€å€‹ï¼‰

**ç¤ºæ„åœ–**ï¼š
```
|<-------------- ç¯€é»ç¸½å¯¬åº¦ -------------->|
|  inner  |<-- text width -->|  inner     |
|  sep    |   æ–‡å­—å…§å®¹å€åŸŸ    |  sep       |
| (0.2cm) |     (4cm)        | (0.2cm)    |
|---------|------------------|------------|
         ç¸½å¯¬åº¦ = 4 + 0.2 + 0.2 = 4.4cm
```

---

## ğŸ“Š ç•¶å‰ä»£ç¢¼åˆ†æ

### **æƒ…å¢ƒ1: ç„¡åœ–å½¢çš„æƒ…æ³**

#### **ç•¶å‰ä»£ç¢¼ï¼ˆç¬¬143è¡Œï¼Œç¬¬169è¡Œï¼‰**
```python
# ç¬¬143è¡Œ
content_width = round(w - 2 * 0.1, 3)  # wæ˜¯æ ¼å­å¯¬åº¦

# ç¬¬169è¡Œ
content += f"\\node[anchor=north west, text width={content_width}cm, inner sep={node_inner_sep}] at ({{ {x}+{text_x_offset} }}, {{ {y}+{text_y_offset} }}) {{{question_body}}};\n"
```

**è®Šæ•¸å®šç¾©**ï¼š
- `w`: æ ¼å­å¯¬åº¦ï¼ˆä¾‹å¦‚ 4.5cmï¼‰
- `text_x_offset = 0.1`: ç¯€é»èµ·å§‹ä½ç½®è·æ ¼å­å·¦é‚Šç·£çš„åç§»
- `node_inner_sep = "0.2cm"`: TikZ node çš„å…§é‚Šè·
- `content_width`: è¨ˆç®—å‡ºçš„ text width å€¼

#### **ç•¶å‰è¨ˆç®—é‚è¼¯**
```
å‡è¨­ w = 4.5cm

è¨ˆç®—ï¼š
content_width = 4.5 - 2 * 0.1 = 4.3cm

ç¯€é»ä½ç½®ï¼š
- èµ·å§‹ä½ç½®: x + 0.1cm (æ ¼å­å·¦é‚Š + 0.1cm)
- text width: 4.3cm
- inner sep: 0.2cm (å·¦å³å„)

ç¯€é»ä½”ç”¨å¯¬åº¦è¨ˆç®—ï¼š
- ç¯€é»ç¸½å¯¬åº¦ = text_width + 2 Ã— inner_sep
             = 4.3 + 2 Ã— 0.2
             = 4.7cm

å¯¦éš›ä½”ç”¨ç¯„åœï¼š
- å·¦é‚Šç•Œ: x + 0.1cm
- å³é‚Šç•Œ: x + 0.1 + 4.7 = x + 4.8cm
- æ ¼å­å³é‚Šç•Œ: x + 4.5cm

çµè«–ï¼šx + 4.8 > x + 4.5
âŒ è¶…å‡ºæ ¼å­å³é‚Šç•Œ 0.3cmï¼
```

---

### **æƒ…å¢ƒ2: åœ–å½¢åœ¨å³å´çš„æƒ…æ³**

#### **ç•¶å‰ä»£ç¢¼ï¼ˆç¬¬141è¡Œï¼Œç¬¬155è¡Œï¼‰**
```python
# ç¬¬141è¡Œ
text_w = round(text_width_ratio * w, 3)  # text_width_ratio = 0.6

# ç¬¬155è¡Œï¼ˆæ–‡å­—ç¯€é»ï¼‰
content += f"\\node[anchor=north west, text width={text_w}cm, inner sep={node_inner_sep}] at ({{ {x}+{text_x_offset} }}, {{ {y}+{text_y_offset} }}) {{{question_body}}};\n"

# ç¬¬156è¡Œï¼ˆåœ–å½¢ç¯€é»ï¼‰
content += f"\\node[anchor=north east, text width={figure_w}cm, inner sep={node_inner_sep}, align=center] at ({{ {x+w} }}, {{ {y}+{figure_y_offset} }}) {{{resized_figure}}};\n"
```

#### **ç•¶å‰è¨ˆç®—é‚è¼¯**
```
å‡è¨­ w = 4.5cm, text_width_ratio = 0.6, figure_width_ratio = 0.35

è¨ˆç®—ï¼š
text_w = 0.6 Ã— 4.5 = 2.7cm
figure_w = 0.35 Ã— 4.5 = 1.575cm

æ–‡å­—ç¯€é»ï¼š
- èµ·å§‹ä½ç½®: x + 0.1cm
- ç¯€é»ç¸½å¯¬åº¦ = 2.7 + 2 Ã— 0.2 = 3.1cm
- å³é‚Šç•Œ: x + 0.1 + 3.1 = x + 3.2cm

åœ–å½¢ç¯€é»ï¼ˆanchor=north eastï¼‰ï¼š
- éŒ¨é»ä½ç½®: x + 4.5cm (æ ¼å­å³é‚Šç•Œ)
- ç¯€é»ç¸½å¯¬åº¦ = 1.575 + 2 Ã— 0.2 = 1.975cm
- å·¦é‚Šç•Œ: x + 4.5 - 1.975 = x + 2.525cm

æª¢æŸ¥é‡ç–Šï¼š
æ–‡å­—å³é‚Šç•Œ (x + 3.2) vs åœ–å½¢å·¦é‚Šç•Œ (x + 2.525)
âŒ æ–‡å­—ä¾µå…¥åœ–å½¢å€åŸŸï¼é‡ç–Š 0.675cm
```

---

## ğŸ¯ å•é¡Œæ ¹æºç¢ºèª

### **æ ¸å¿ƒå•é¡Œ**

1. **content_width è¨ˆç®—éŒ¯èª¤**ï¼š
   ```python
   content_width = round(w - 2 * 0.1, 3)
   ```
   åªæ‰£é™¤äº†å·¦å³ `text_x_offset`ï¼Œ**æ²’æœ‰è€ƒæ…® inner sep æœƒé¡å¤–å¢åŠ ç¯€é»å¯¬åº¦**

2. **text_w è¨ˆç®—æœªè€ƒæ…®é–“è·**ï¼š
   ```python
   text_w = round(text_width_ratio * w, 3)
   ```
   ç›´æ¥ç”¨æ¯”ä¾‹è¨ˆç®—ï¼Œ**æ²’æœ‰æ‰£é™¤ offset å’Œ inner sep**

---

## ğŸ’¡ ä¿®å¾©æ–¹æ¡ˆæ¨å°

### **æ–¹æ¡ˆAï¼šæ‰£é™¤æ‰€æœ‰é‚Šè·ï¼ˆæ¨è–¦ï¼‰**

#### **ç„¡åœ–å½¢æƒ…æ³**

**ç›®æ¨™**ï¼šç¢ºä¿ç¯€é»ä¸è¶…å‡ºæ ¼å­å³é‚Šç•Œ

```
å·²çŸ¥ï¼š
- æ ¼å­å¯¬åº¦: w
- èµ·å§‹ä½ç½®: x + text_x_offset
- å¯ç”¨å¯¬åº¦: w - text_x_offset
- ç¯€é»ç¸½å¯¬åº¦: text_width + 2 Ã— inner_sep

æ¢ä»¶ï¼š
èµ·å§‹ä½ç½® + ç¯€é»ç¸½å¯¬åº¦ â‰¤ æ ¼å­å³é‚Šç•Œ
(x + text_x_offset) + (text_width + 2 Ã— inner_sep) â‰¤ x + w

æ¨å°ï¼š
text_x_offset + text_width + 2 Ã— inner_sep â‰¤ w
text_width â‰¤ w - text_x_offset - 2 Ã— inner_sep

è¨­å®‰å…¨é¤˜é‡ margin = 0.1cmï¼š
text_width â‰¤ w - text_x_offset - 2 Ã— inner_sep - margin

å»ºè­°å…¬å¼ï¼š
content_width = w - text_x_offset - 2 Ã— inner_sep_value - margin
              = w - 0.1 - 2 Ã— 0.2 - 0.1
              = w - 0.6
```

**é©—è­‰**ï¼ˆw = 4.5cmï¼‰ï¼š
```
content_width = 4.5 - 0.6 = 3.9cm
ç¯€é»ç¸½å¯¬åº¦ = 3.9 + 2 Ã— 0.2 = 4.3cm
å³é‚Šç•Œ = 0.1 + 4.3 = 4.4cm
æ ¼å­å³é‚Šç•Œ = 4.5cm
é¤˜é‡ = 4.5 - 4.4 = 0.1cm âœ…
```

#### **æœ‰åœ–å½¢æƒ…æ³ï¼ˆå³å´ï¼‰**

**ç›®æ¨™**ï¼šæ–‡å­—å’Œåœ–å½¢åˆç†åˆ†é…ç©ºé–“ï¼Œä¸é‡ç–Šä¸è¶…å‡º

```
å·²çŸ¥ï¼š
- æ ¼å­å¯¬åº¦: w
- æ–‡å­—èµ·å§‹: x + text_x_offset
- åœ–å½¢éŒ¨é»ï¼ˆå³å°é½Šï¼‰: x + w
- é æœŸé–“è·: gap (æ–‡å­—å’Œåœ–å½¢ä¹‹é–“)

åˆ†é…ç©ºé–“ï¼š
å¯ç”¨ç¸½å¯¬åº¦ = w - text_x_offset
éœ€æ‰£é™¤: æ–‡å­— inner_sep (å·¦), åœ–å½¢ inner_sep (å³), ä¸­é–“é–“è·

æ–‡å­—å€åŸŸ:
text_node_total = text_width + inner_sep_left

åœ–å½¢å€åŸŸ:
figure_node_total = figure_width + inner_sep_right

æ¢ä»¶ï¼š
text_x_offset + text_node_total + gap + figure_node_total â‰¤ w

ç°¡åŒ–ï¼ˆå‡è¨­å·¦å³ inner_sep ç›¸åŒï¼‰ï¼š
text_x_offset + (text_width + inner_sep) + gap + (figure_width + inner_sep) â‰¤ w
text_width + figure_width â‰¤ w - text_x_offset - 2Ã—inner_sep - gap

å»ºè­°åˆ†é…ï¼ˆgap = 0.2cmï¼‰ï¼š
text_width = text_ratio Ã— (w - text_x_offset - 2Ã—inner_sep - gap)
figure_width = figure_ratio Ã— (w - text_x_offset - 2Ã—inner_sep - gap)

å…¶ä¸­ text_ratio + figure_ratio = 1
```

**é©—è­‰**ï¼ˆw = 4.5cm, text_ratio = 0.65, figure_ratio = 0.35ï¼‰ï¼š
```
å¯ç”¨å¯¬åº¦ = 4.5 - 0.1 - 2Ã—0.2 - 0.2 = 3.8cm

text_width = 0.65 Ã— 3.8 = 2.47cm
figure_width = 0.35 Ã— 3.8 = 1.33cm

æ–‡å­—ç¯€é»ç¸½å¯¬ = 2.47 + 0.2 = 2.67cm
åœ–å½¢ç¯€é»ç¸½å¯¬ = 1.33 + 0.2 = 1.53cm

æ–‡å­—ç¯„åœ: [0.1, 2.77]
é–“è·: [2.77, 2.97]  (0.2cm gap)
åœ–å½¢ç¯„åœ: [2.97, 4.5]  (å¾å³å°é½Šç®—èµ·: 4.5 - 1.53 = 2.97)

æª¢æŸ¥: 2.77 + 0.2 = 2.97 âœ… å®Œç¾å°é½Šï¼
ç¸½ä½”ç”¨: 0.1 + 2.67 + 0.2 + 1.53 = 4.5 âœ… å‰›å¥½å¡«æ»¿ï¼
```

---

### **æ–¹æ¡ˆBï¼šèª¿æ•´ inner sepï¼ˆä¸æ¨è–¦ï¼‰**

å°‡ `inner sep` è¨­ç‚º 0ï¼Œç›´æ¥ç”¨ padding æ–¹å¼è™•ç†ã€‚

**ç¼ºé»**ï¼š
- ç ´å£ TikZ æ¨™æº–èªç¾©
- èˆ‡å…¶ä»–ç¯€é»æ¨£å¼ä¸ä¸€è‡´
- ç¶­è­·å›°é›£

---

## ğŸ“‹ ä¿®å¾©è¨ˆç•«ï¼ˆæ–¹æ¡ˆAï¼‰

### **ä¿®æ”¹é …ç›®**

#### **1. å®šç¾©å¸¸æ•¸**
```python
# ç¬¬145-149è¡Œä¹‹å‰æ’å…¥
INNER_SEP_VALUE = 0.2  # cmï¼Œèˆ‡ node_inner_sep ä¿æŒä¸€è‡´
SAFETY_MARGIN = 0.1    # cmï¼Œå®‰å…¨é¤˜é‡
TEXT_FIGURE_GAP = 0.2  # cmï¼Œæ–‡å­—å’Œåœ–å½¢é–“è·
```

#### **2. ä¿®æ”¹ç„¡åœ–å½¢å¯¬åº¦è¨ˆç®—**
```python
# ç¬¬143è¡Œ
# ä¿®æ”¹å‰ï¼š
content_width = round(w - 2 * 0.1, 3)

# ä¿®æ”¹å¾Œï¼š
content_width = round(w - text_x_offset - 2 * INNER_SEP_VALUE - SAFETY_MARGIN, 3)
# = w - 0.1 - 2*0.2 - 0.1 = w - 0.6
```

#### **3. ä¿®æ”¹æœ‰åœ–å½¢å¯¬åº¦è¨ˆç®—**
```python
# ç¬¬141-142è¡Œ
# ä¿®æ”¹å‰ï¼š
text_w = round(text_width_ratio * w, 3)
figure_w = round(figure_width_ratio * w, 3)

# ä¿®æ”¹å¾Œï¼š
available_width = w - text_x_offset - 2 * INNER_SEP_VALUE - TEXT_FIGURE_GAP
text_w = round(text_width_ratio * available_width, 3)
figure_w = round(figure_width_ratio * available_width, 3)
```

#### **4. èª¿æ•´æ¯”ä¾‹ï¼ˆå¯é¸ï¼‰**
```python
# ç¬¬135, 138è¡Œ
# è€ƒæ…®èª¿æ•´æ¯”ä¾‹ä»¥æ›´å¥½åˆ©ç”¨ç©ºé–“
if width_cells == 1:
    text_width_ratio = 0.65  # å¾ 0.6 æé«˜åˆ° 0.65
    figure_width_ratio = 0.35
else:
    text_width_ratio = 0.65
    figure_width_ratio = 0.35
```

---

## âš ï¸ æ³¨æ„äº‹é …

1. **bottom ä½ç½®çš„åœ–å½¢**ï¼ˆç¬¬162-164è¡Œï¼‰ï¼š
   - ä¹Ÿä½¿ç”¨ `content_width`
   - æ‡‰åŒæ­¥ä¿®æ”¹

2. **left ä½ç½®çš„åœ–å½¢**ï¼ˆç¬¬157-160è¡Œï¼‰ï¼š
   - åŒæ¨£éœ€è¦èª¿æ•´è¨ˆç®—é‚è¼¯
   - ç¢ºä¿æ–‡å­—ä¸æœƒè¶…å‡ºå³é‚Šç•Œ

3. **æ¸¬è©¦é©—è­‰**ï¼š
   - éœ€è¦æ¸¬è©¦å„ç¨®æ ¼å­å¤§å°ï¼ˆSmall, Square, Wide, Mediumç­‰ï¼‰
   - éœ€è¦æ¸¬è©¦æœ‰ç„¡åœ–å½¢çš„æƒ…æ³
   - éœ€è¦æ¸¬è©¦åœ–å½¢åœ¨ä¸åŒä½ç½®ï¼ˆleft, right, bottomï¼‰

---

## ğŸ”¬ é©—è­‰æ–¹æ³•

### **ç†è«–é©—è­‰**
é‡å°æ¯ç¨®æƒ…æ³è¨ˆç®—ï¼š
1. ç¯€é»èµ·å§‹ä½ç½®
2. ç¯€é»ç¸½å¯¬åº¦
3. ç¯€é»çµæŸä½ç½®
4. æ˜¯å¦è¶…å‡ºæ ¼å­å³é‚Šç•Œ

### **å¯¦éš›æ¸¬è©¦**
ç”Ÿæˆæ¸¬è©¦ PDFï¼Œæª¢æŸ¥ï¼š
1. æ–‡å­—æ˜¯å¦è¶…å‡ºæ ¼å­
2. æ–‡å­—å’Œåœ–å½¢æ˜¯å¦é‡ç–Š
3. ç‰ˆé¢æ˜¯å¦ç¾è§€

---

## âœ… é æœŸæ•ˆæœ

ä¿®å¾©å¾Œï¼š
- âœ… æ–‡å­—ä¸æœƒè¶…å‡ºæ ¼å­å³é‚Šç•Œ
- âœ… æ–‡å­—å’Œåœ–å½¢ä¸æœƒé‡ç–Š
- âœ… ä¿æŒé©ç•¶çš„é–“è·å’Œé¤˜é‡
- âœ… æ”¯æŒæ‰€æœ‰æ ¼å­å¤§å°å’Œåœ–å½¢ä½ç½®

---

**ç‹€æ…‹**: å¾…ç¢ºèªä¿®å¾©è¨ˆç•«å¾ŒåŸ·è¡Œ
**ä¸‹ä¸€æ­¥**: ç”¨æˆ¶ç¢ºèªè¨ˆç•«å¾Œé€²è¡Œä»£ç¢¼ä¿®æ”¹
