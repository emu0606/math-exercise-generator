\documentclass[a4paper,11pt]{article}
\usepackage{xeCJK}
\usepackage[margin=1.8cm]{geometry}
\usepackage{tikz}
\usetikzlibrary{positioning, shadows, calc, arrows.meta, angles, quotes} % Added angles and quotes
\usepackage{amsmath,amssymb}
\usepackage{multicol}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{mdframed} % mdframed 可能不再需要，但暫時保留以防萬一
\usepackage[most]{tcolorbox} % 確保 tcolorbox 加載
\usepackage{fontspec}
\usepackage{lmodern}
% \usepackage{wrapfig} % 移除 wrapfig

% 設定字體
\setCJKmainfont[
  Path=./assets/fonts/,
  Extension=.otf,
  BoldFont=SourceHanSansTC-Bold
]{SourceHanSansTC-Regular}

% 設定英文和數字字體
\setmainfont[
  Path=./assets/fonts/,
  Extension=.otf,
  BoldFont=SourceHanSansTC-Bold
]{SourceHanSansTC-Regular}

% 設定等寬字體 (如果有)
\setmonofont[
  Path=./assets/fonts/,
  Extension=.otf
]{SourceHanSansTC-Regular}


% 全局字體設置
\renewcommand{\normalsize}{\fontsize{11pt}{15pt}\selectfont}
\renewcommand{\large}{\fontsize{14pt}{18pt}\selectfont}
\renewcommand{\Large}{\fontsize{16pt}{20pt}\selectfont}
\renewcommand{\huge}{\fontsize{20pt}{24pt}\selectfont}


% 設定頁面樣式
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\thepage}

% 設定段落間距
\setlength{\parskip}{0.5em}
\setlength{\parindent}{0em}

% 設定列表樣式
\setlist[enumerate]{leftmargin=*,labelsep=0.5em,topsep=0.3em,itemsep=0.2em}

% 定義顏色
\definecolor{answerframe}{RGB}{120,120,120}
\definecolor{answerback}{RGB}{248,248,248}
\definecolor{explanationframe}{RGB}{70,130,180} % 保持顏色定義
\definecolor{explanationback}{RGB}{240,248,255} % 保持顏色定義
\definecolor{roundtitle}{RGB}{50,50,50}
\definecolor{accent6}{RGB}{52,73,94} % Added accent color for question number box


% Command for shadowed rounded rectangle question number
\newcommand{\qnumShadowBox}[1]{%
  \tikz[remember picture]{
    \node[rectangle, rounded corners=3pt, fill=white, draw=accent6, drop shadow, inner sep=2pt] (qnum) {\bfseries #1};
  }
}

% 設計5: 簡潔分隔線設計 (來自 testlatex5.tex) - 用於簡答頁
\newcommand{\numberedAnswerLine}[2]{%
  \begin{minipage}{0.3\textwidth} % 調整寬度以適應頁面
    \begin{tikzpicture}
      % 題號小方框
      \draw[fill=lightgray, draw=darkgray!70] (0,0) rectangle (0.55,0.55);
      \node[font=\small\bfseries] at (0.275,0.275) {#1};

      % 答案與下劃線
      \node[font=\large, anchor=west] at (0.8,0.275) {#2};
      % 調整下劃線長度以匹配 minipage 寬度減去題號框和間距
      \pgfmathsetlengthmacro{\linewidthcalc}{\linewidth - 0.8cm - 0.55cm} % 估算可用寬度
      \draw[darkgray, line width=0.8pt] (0.8,-.2) -- +(\linewidthcalc,0); % 從答案左側開始繪製
    \end{tikzpicture}
    \vspace{0.6cm} % 項目之間的垂直間距
  \end{minipage}%
}

% 設計5分隔線行 (來自 testlatex5.tex) - 用於簡答頁
\newenvironment{answerRow}{%
  \noindent\begin{minipage}{\textwidth} % 使用完整寬度
    \centering % 讓 minipage 內的內容居中（如果 minipage 總寬度小於 textwidth）
    \setlength{\lineskip}{1pt} % 調整行間距，根據需要
    \setlength{\parskip}{0pt} % 移除段落間距
    \raggedright % 讓 minipage 內的內容靠左對齊
}{%
  \end{minipage}
  \vspace{0.2cm} % 行之間的垂直間距
}

% *** 修改：定義 explanationbox 樣式和命令 ***
\tcbset{
    explanationstyle/.style={
        enhanced,
        breakable=true, % 允許盒子跨欄/頁
        colback=explanationback, % 使用預定義顏色
        colframe=explanationframe, % 使用預定義顏色
        arc=2mm,
        boxrule=0.5pt,
        fontupper=\fontsize{9pt}{11pt}\selectfont, % 設定內容字體
        % 使用 tcolorbox 的標準間距，或根據需要調整
        % before skip=1em, % 可選
        % after skip=1em, % 可選
        left=2mm, right=2mm, top=2mm, bottom=2mm % 內邊距
    }
}
% 定義 explanationbox 命令以使用樣式
\newcommand{\explanationbox}[2][]{% #1 for optional tcolorbox options
  \begin{tcolorbox}[explanationstyle, #1]
    #2
  \end{tcolorbox}
}

% 回標題樣式
\newcommand{\roundtitle}[1]{%
    \begin{center}
        \colorbox{roundtitle!10}{%
            \begin{minipage}{0.95\textwidth}
                \centering\large\textbf{\textcolor{roundtitle}{#1}}
            \end{minipage}
        }
    \end{center}
    \vspace{0.5em}
}

% 設定標題樣式
\usepackage{titlesec}
\titleformat{\subsection}
  {\normalfont\large\bfseries}{\thesubsection}{1em}{}
\titlespacing*{\subsection}{0pt}{2em}{1em}

% 設定標題
\title{\huge 數學計算練習}
\author{\large 數學測驗生成器}
\date{\large \today}

\begin{document}
\begin{center}
{\Large \textbf{數學計算練習 - 簡答}}
\end{center}

\noindent 生成日期：2025-09-28\hfill

\roundtitle{第1回}

\begin{answerRow}
  \numberedAnswerLine{1}{$\frac{\sqrt{2}}{2}$}
  \numberedAnswerLine{2}{$\frac{\sqrt{2}}{2}$}
  \numberedAnswerLine{3}{$-45^\circ$}
\end{answerRow}
\begin{answerRow}
  \numberedAnswerLine{4}{$-90^\circ$}
  \numberedAnswerLine{5}{$90^\circ$}
  \numberedAnswerLine{6}{$-\tan(80^\circ)$}
\end{answerRow}
\begin{answerRow}
  \numberedAnswerLine{7}{$\tan(70^\circ)$}
  \numberedAnswerLine{8}{$\sqrt{17} + \sqrt{11}$}
  \numberedAnswerLine{9}{$\sqrt{10} + 3$}
\end{answerRow}
\begin{answerRow}
  \numberedAnswerLine{10}{$5 + \sqrt{10}$}
\end{answerRow}
\vfill
\begin{center}
\small{生成日期：2025-09-28}
\end{center}
\end{document}
