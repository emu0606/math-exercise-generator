\documentclass[a4paper,11pt]{article}
\usepackage{xeCJK}
\usepackage[margin=1.8cm]{geometry}
\usepackage{tikz}
\usetikzlibrary{positioning, shadows, calc} % Added shadows and calc
\usepackage{amsmath,amssymb}
\usepackage{multicol}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{mdframed}
\usepackage[most]{tcolorbox}
\usepackage{fontspec}
\usepackage{wrapfig} % Added for text wrapping around figures

% 設定字體
\setCJKmainfont[
  Path=./assets/fonts/,
  Extension=.otf,
  BoldFont=SourceHanSansTC-Bold
]{SourceHanSansTC-Regular}

% 設定英文和數字字體
\setmainfont[
  Path=./assets/fonts/,
  Extension=.otf,
  BoldFont=SourceHanSansTC-Bold
]{SourceHanSansTC-Regular}

% 設定等寬字體 (如果有)
\setmonofont[
  Path=./assets/fonts/,
  Extension=.otf
]{SourceHanSansTC-Regular}




% 全局字體設置
\renewcommand{\normalsize}{\fontsize{11pt}{15pt}\selectfont}
\renewcommand{\large}{\fontsize{14pt}{18pt}\selectfont}
\renewcommand{\Large}{\fontsize{16pt}{20pt}\selectfont}
\renewcommand{\huge}{\fontsize{20pt}{24pt}\selectfont}


% 設定頁面樣式
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\thepage}

% 設定段落間距
\setlength{\parskip}{0.5em}
\setlength{\parindent}{0em}

% 設定列表樣式
\setlist[enumerate]{leftmargin=*,labelsep=0.5em,topsep=0.3em,itemsep=0.2em}

% 定義顏色
\definecolor{answerframe}{RGB}{120,120,120}
\definecolor{answerback}{RGB}{248,248,248}
\definecolor{explanationframe}{RGB}{70,130,180}
\definecolor{explanationback}{RGB}{240,248,255}
\definecolor{roundtitle}{RGB}{50,50,50}
\definecolor{accent6}{RGB}{52,73,94} % Added accent color for question number box


% Command for shadowed rounded rectangle question number
\newcommand{\qnumShadowBox}[1]{%
  \tikz[remember picture]{
    \node[rectangle, rounded corners=3pt, fill=white, draw=accent6, drop shadow, inner sep=2pt] (qnum) {\bfseries #1};
  }
}

% 答案盒子模板
\tcbset{
    answer/.style={
        enhanced, % Needed for attach boxed title options
        colback=answerback,
        colframe=answerframe,
        arc=2mm, % Main box corner radius
        boxrule=0.5pt,
        % --- Title Box Settings ---
        attach boxed title to top left={yshift=0mm, xshift=0mm}, % Align top-left corners
        boxed title style={
            colback=white, % White background for title
            colframe=accent6, % Gray border for title
            arc=1mm, % Slightly smaller or equal radius for title box corners
            boxrule=0.5pt, % Match main box rule thickness
        },
        fonttitle=\bfseries\fontsize{9pt}{11pt}\selectfont, % Smaller bold title font
        coltitle=black, % Title text color
        % --- Padding ---
        left=2mm,
        % top=1.5em % Adjust top padding if needed later
    }
}

% 答案列表環境
\newenvironment{answerraster}{%
    \begin{tcbraster}[
        raster columns=3,
        raster column skip=0.4cm,
        raster row skip=0.3cm,
        raster left skip=0pt,
        raster right skip=0pt
    ]
}{%
    \end{tcbraster}
}


% 自定義環境
\newcommand{\answerbox}[2]{%
    \begin{tcolorbox}[
        answer,
        width=0.3\textwidth,
        text width=0.28\textwidth,
        title={#1}
    ]
        #2
    \end{tcolorbox}
}

% 定義 explanationbox 樣式
\tcbset{
    explanationstyle/.style={
        enhanced,
        breakable, % 允許盒子跨欄/頁
        colback=explanationback,
        colframe=explanationframe,
        arc=2mm,
        boxrule=0.5pt,
        fontupper=\fontsize{9pt}{11pt}\selectfont, % 設定內容字體為 9pt
        before skip=1em, % 控制盒子上方間距 (可調整)
        after skip=1em   % 控制盒子下方間距 (可調整)
    }
}
% 更新 explanationbox 命令以使用新樣式
\newcommand{\explanationbox}[1]{%
  \begin{tcolorbox}[explanationstyle]
    #1
  \end{tcolorbox}
}

% 回標題樣式
\newcommand{\roundtitle}[1]{%
    \begin{center}
        \colorbox{roundtitle!10}{%
            \begin{minipage}{0.95\textwidth}
                \centering\large\textbf{\textcolor{roundtitle}{#1}}
            \end{minipage}
        }
    \end{center}
    \vspace{0.5em}
}

% 設定標題樣式
\usepackage{titlesec}
\titleformat{\subsection}
  {\normalfont\large\bfseries}{\thesubsection}{1em}{}
\titlespacing*{\subsection}{0pt}{2em}{1em}

% 設定標題
\title{\huge 數學計算練習}
\author{\large 數學測驗生成器}
\date{\large \today}



\begin{document}
\noindent 第1回 \hfill \_\_\_月\_\_\_\_日 \hfill 姓名：\_\_\_\_\_\_\_\_\_

\begin{center}
\begin{tikzpicture}
  % 題目 1
  \draw[rounded corners=3pt, thick] (0.0, 0.0) rectangle (8.45, -2.457);
  \node[overlay, anchor=north west, inner sep=0] at ({ 0.0 }, { 0.0 }) {\qnumShadowBox{1}};
  \node[anchor=north west, text width=8.25cm, inner sep=0.2cm] at ({ 0.0+0.1 }, { 0.0+-0.5 }) {化簡：$\sqrt{40 - 16 \sqrt{6}}$};

\end{tikzpicture}
\end{center}
\vfill
\begin{center}
\small{生成日期：2025-05-01}
\end{center}
\end{document}
